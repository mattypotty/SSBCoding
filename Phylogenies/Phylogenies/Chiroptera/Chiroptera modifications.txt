
################################################################################################################################################################
###########################################################Emballonuridae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Emballonuridae<-read.tree(text="((((Centronycteris_centralis:1,Centronycteris_maximiliani:1):1,((Saccopteryx_gymnura:1,Saccopteryx_canescens:1):1,(Saccopteryx_leptura:1,Saccopteryx_bilineata:1):1):1):1,Rhynchonycteris_naso:1):1,(((Balantiopteryx_plicata:1,(Balantiopteryx_infusca:1,Balantiopteryx_io:1):1):1,((Peropteryx_leucoptera:1,((Peropteryx_macrotis:1,Peropteryx_kappleri:1):1,Peropteryx_trinitatis:1):1):1,(Cormura_brevirostris:1,(Cyttarops_alecto:1,(((Diclidurus_albus:1,Diclidurus_ingens:1):1,Diclidurus_scutatus:1):1,Diclidurus_isabellus:1):1):1):1):1):1,((Taphozous_longimanus:1,Saccolaimus_saccolaimus:1):1,((Emballonura_beccarii:1,Emballonura_monticola:1):1,Mosia_nigrescens:1):1):1):1);")
PHYLO<-Emballonuridae
#One of the trees for the genus Lagenorhynchus from the posterior distribution
Emballonura<-read.tree(text="((Emballonura_atrata:1,Emballonura_tiavato:1):1,((((Emballonura_monticola:1,Emballonura_alecto:1):1,Emballonura_raffrayana:1):1,Emballonura_semicaudata:1):1,(Emballonura_serii:1,Emballonura_beccarii:1):1):1);")
MONOP.GROUP<-c("Emballonura_beccarii", "Emballonura_monticola", "Emballonura_alecto", "Emballonura_atrata", "Emballonura_raffrayana", "Emballonura_semicaudata", "Emballonura_serii", "Emballonura_tiavato")
#Merging the family tree with the tree for Emballonura
Replace.groups(Emballonura, MONOP.GROUP)

#Place Saccopteryx_antioquensis based on taxonomy
SisterOrSing1(c("Saccopteryx_bilineata", "Saccopteryx_leptura", "Saccopteryx_gymnura", "Saccopteryx_canescens"), "Saccopteryx_antioquensis")
#Place missing species of Emballonura based on Nature 446, 507-512 (2007)
Start<-c("Emballonura_atrata", "Emballonura_beccarii", "Emballonura_raffrayana", "Emballonura_semicaudata", "Emballonura_tiavato", list(c("Emballonura_alecto", "Emballonura_monticola")))
MIS<-c("Emballonura_dianae", "Emballonura_furax")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Coleura as sister to Emballonura based on Nature 446, 507-512 (2007)
SisterAnd1( c("Emballonura_atrata", "Emballonura_beccarii", "Emballonura_raffrayana", "Emballonura_semicaudata", "Emballonura_tiavato", "Emballonura_alecto", "Emballonura_monticola", "Emballonura_dianae", "Emballonura_furax"), "Coleura_afra")
Sister1("Coleura_afra", "Coleura_seychellensis")
#Place missing species of Saccolaimus based on Nature 446, 507-512 (2007)
Sister2("Saccolaimus_saccolaimus", "Saccolaimus_flaviventris", "Saccolaimus_mixtus")
SisterAnd1(c("Saccolaimus_saccolaimus", "Saccolaimus_flaviventris", "Saccolaimus_mixtus"), "Saccolaimus_peli")
#Place missing species of Taphozous based on Nature 446, 507-512 (2007)
TR<-read.tree(text="(Taphozous_longimanus:1, Taphozous_melanopogon:1, Taphozous_hildegardeae:1, Taphozous_mauritianus:1, Taphozous_perforatus:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),  "Taphozous_longimanus"))
Sister1("Taphozous_melanopogon", "Taphozous_achates")
SisterAnd1(c( "Taphozous_longimanus", "Taphozous_melanopogon", "Taphozous_hildegardeae", "Taphozous_mauritianus", "Taphozous_perforatus", "Taphozous_achates"), "Taphozous_australis")
Sister2("Taphozous_australis", "Taphozous_georgianus", "Taphozous_kapalgensis")
Sister1("Taphozous_georgianus", "Taphozous_troughtoni")
SisterAnd1(c( "Taphozous_australis", "Taphozous_georgianus", "Taphozous_kapalgensis", "Taphozous_troughtoni"), "Taphozous_hilli")
SisterAnd1(c( "Taphozous_australis", "Taphozous_georgianus", "Taphozous_kapalgensis", "Taphozous_troughtoni", "Taphozous_hilli"), "Taphozous_theobaldi")
SisterAnd1(c( "Taphozous_australis", "Taphozous_georgianus", "Taphozous_kapalgensis", "Taphozous_troughtoni", "Taphozous_hilli", "Taphozous_theobaldi",  "Taphozous_longimanus", "Taphozous_melanopogon", "Taphozous_hildegardeae", "Taphozous_mauritianus", "Taphozous_perforatus", "Taphozous_achates"), "Taphozous_hamiltoni")
Sister1("Taphozous_hamiltoni", "Taphozous_nudiventris")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 42 MYA following Meredith et al (2011)
BD.gen(42,0.355)
PHYLO->Emballonuridae

################################################################################################################################################################
###########################################################Hipposideridae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Hipposideridae<-read.tree(text="((Triaenops_persicus:1,(Cloeotis_percivali:1,Rhinonicteris_aurantia:1):1):1,((Hipposideros_obscurus:1,(((Hipposideros_pelingensis:1,Hipposideros_diadema:1):1,((Hipposideros_larvatus:1,Hipposideros_armiger:1):1,(Hipposideros_scutinares:1,Hipposideros_lylei:1):1):1):1,((Hipposideros_galeritus:1,Hipposideros_cervinus:1):1,(((Hipposideros_doriae:1,(Hipposideros_halophyllus:1,(Hipposideros_fulvus:1,Hipposideros_ridleyi:1):1):1):1,Hipposideros_ater:1):1,((((Hipposideros_khaokhouayensis:1,Hipposideros_rotalis:1):1,Hipposideros_pomona:1):1,(Hipposideros_bicolor:1,Hipposideros_cineraceus:1):1):1,Hipposideros_dyacorum:1):1):1):1):1):1,(Asellia_tridens:1,(Aselliscus_stoliczkanus:1,Coelops_frithii:1):1):1):1);")
PHYLO<-Hipposideridae
#One of the trees for the genus Hipposideros from the posterior distribution
Hipposideros<-read.tree(text="((Hipposideros_gigas:1,Hipposideros_cyclops:1):1,((((((Hipposideros_cervinus:1,Hipposideros_coxi:1):1,Hipposideros_galeritus:1):1,((((Hipposideros_doriae:1,Hipposideros_dyacorum:1):1,(((Hipposideros_rotalis:1,Hipposideros_khaokhouayensis:1):1,(Hipposideros_pomona:1,(Hipposideros_bicolor:1,Hipposideros_cineraceus:1):1):1):1,(Hipposideros_ater:1,Hipposideros_ridleyi:1):1):1):1,Hipposideros_halophyllus:1):1,(Hipposideros_calcaratus:1,Hipposideros_fulvus:1):1):1):1,(((Hipposideros_ruber:1,(Hipposideros_abae:1,Hipposideros_beatus:1):1):1,Hipposideros_caffer:1):1,Hipposideros_fuliginosus:1):1):1,((Hipposideros_armiger:1,Hipposideros_larvatus:1):1,(((Hipposideros_scutinares:1,Hipposideros_pratti:1):1,Hipposideros_lylei:1):1,(Hipposideros_diadema:1,(Hipposideros_dinops:1,Hipposideros_pelingensis:1):1):1):1):1):1,(((Hipposideros_obscurus:1,Hipposideros_jonesi:1):1,Hipposideros_speoris:1):1,Hipposideros_boeadii:1):1):1);")
MONOP.GROUP<-c("Hipposideros_armiger", "Hipposideros_ater", "Hipposideros_bicolor", "Hipposideros_cervinus", "Hipposideros_cineraceus", "Hipposideros_diadema", "Hipposideros_doriae", "Hipposideros_dyacorum", "Hipposideros_fulvus", "Hipposideros_galeritus", "Hipposideros_halophyllus", "Hipposideros_khaokhouayensis", "Hipposideros_larvatus", "Hipposideros_lylei", "Hipposideros_obscurus", "Hipposideros_pelingensis", "Hipposideros_pomona", "Hipposideros_ridleyi", "Hipposideros_rotalis", "Hipposideros_scutinares", "Hipposideros_abae", "Hipposideros_beatus", "Hipposideros_boeadii", "Hipposideros_caffer", "Hipposideros_calcaratus", "Hipposideros_coxi", "Hipposideros_cyclops", "Hipposideros_dinops", "Hipposideros_fuliginosus", "Hipposideros_gigas", "Hipposideros_jonesi", "Hipposideros_pratti", "Hipposideros_ruber", "Hipposideros_speoris")
#Merging the family tree with the tree for Hipposideros
Replace.groups(Hipposideros, MONOP.GROUP)
#One of the trees for the genus Triaenops from the posterior distribution
Triaenops<-read.tree(text="((Triaenops_rufus:1,Triaenops_persicus:1):1,(Triaenops_auritus:1,Triaenops_furculus:1):1);")
MONOP.GROUP<-c("Triaenops_auritus", "Triaenops_furculus", "Triaenops_persicus", "Triaenops_rufus")
#Merging the family tree with the tree for Triaenops
Replace.groups(Triaenops, MONOP.GROUP)

#Place Asellia_patrizii based on taxonomy
Sister1("Asellia_tridens", "Asellia_patrizii")
#Place Aselliscus_tricuspidatus based on taxonomy
Sister1("Aselliscus_stoliczkanus", "Aselliscus_tricuspidatus")
#Place missing speceis of Coelops based on taxonomy
Sister2("Coelops_frithii", "Coelops_hirsutus", "Coelops_robinsoni")
#Place missing species of Hipposideros based on Nature 446, 507-512 (2007) and the species groups sensu Molecular Phylogenetics and Evolution 62: 597-611 (2012)
TR<-read.tree(text="((Hipposideros_camerunensis:1,Hipposideros_cyclops:1):1, (Hipposideros_corynophyllus:1,((Hipposideros_stenotis:1,Hipposideros_wollastoni:1):1,(Hipposideros_muscinus:1,Hipposideros_semoni:1):1):1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),  "Hipposideros_cyclops"))
SisterOrSing1(c("Hipposideros_camerunensis", "Hipposideros_cyclops", "Hipposideros_corynophyllus", "Hipposideros_stenotis", "Hipposideros_wollastoni", "Hipposideros_muscinus", "Hipposideros_semoni"), "Hipposideros_edwardshilli")
TR<-read.tree(text="(Hipposideros_larvatus:1,Hipposideros_grandis:1,Hipposideros_sumbae:1, Hipposideros_madurae:1, Hipposideros_sorenseni:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),  "Hipposideros_larvatus"))
if  (is.monophyletic(PHYLO, c("Hipposideros_dinops", "Hipposideros_pelingensis"))==T) {PHYLO<-drop.tip(PHYLO, "Hipposideros_pelingensis"); Rep_2_5("Hipposideros_dinops", "Hipposideros_diadema", c("Hipposideros_inexpectatus", "Hipposideros_lankadiva", "Hipposideros_lekaguli")); Sister1("Hipposideros_dinops", "Hipposideros_pelingensis")} else Rep_3_6("Hipposideros_dinops", "Hipposideros_pelingensis", "Hipposideros_diadema", c("Hipposideros_inexpectatus", "Hipposideros_lankadiva", "Hipposideros_lekaguli"))
Sister2("Hipposideros_diadema", "Hipposideros_demissus", "Hipposideros_inornatus")
TR<-read.tree(text="(Hipposideros_commersoni:1,Hipposideros_gigas:1,Hipposideros_thomensis:1, Hipposideros_vittatus:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),  "Hipposideros_gigas"))
Sister1("Hipposideros_armiger", "Hipposideros_turpis")
Start<-c("Hipposideros_khaokhouayensis", "Hipposideros_rotalis", "Hipposideros_ruber", "Hipposideros_cineraceus", "Hipposideros_ater",  "Hipposideros_bicolor", "Hipposideros_dyacorum", "Hipposideros_doriae", "Hipposideros_fulvus", "Hipposideros_calcaratus", "Hipposideros_halophyllus", "Hipposideros_jonesi", "Hipposideros_obscurus", "Hipposideros_pomona", "Hipposideros_ridleyi")
MIS<-c("Hipposideros_orbiculus", "Hipposideros_crumeniferus", "Hipposideros_macrobullatus", "Hipposideros_maggietaylorae", "Hipposideros_marisae", "Hipposideros_nequam",  "Hipposideros_hypophyllus")
MIS1<-MIS[sample.int(7, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(6, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
Sister1("Hipposideros_ruber", "Hipposideros_lamottei")
Sister1("Hipposideros_calcaratus", "Hipposideros_coronatus")
Sister1("Hipposideros_cineraceus", "Hipposideros_durgadasi")
Start<-c("Hipposideros_beatus", "Hipposideros_caffer", "Hipposideros_cervinus", "Hipposideros_coxi", "Hipposideros_fuliginosus", "Hipposideros_galeritus")
MIS<-c("Hipposideros_breviceps", "Hipposideros_curtus", "Hipposideros_papua", "Hipposideros_pygmaeus")
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
SisterOrSing1( c(list(c("Hipposideros_camerunensis", "Hipposideros_cyclops", "Hipposideros_corynophyllus", "Hipposideros_stenotis", "Hipposideros_wollastoni", "Hipposideros_muscinus", "Hipposideros_semoni", "Hipposideros_edwardshilli", "Hipposideros_larvatus", "Hipposideros_grandis", "Hipposideros_sumbae", "Hipposideros_madurae", "Hipposideros_sorenseni", "Hipposideros_dinops", "Hipposideros_pelingensis", "Hipposideros_diadema", "Hipposideros_inexpectatus", "Hipposideros_lankadiva", "Hipposideros_lekaguli", "Hipposideros_demissus", "Hipposideros_inornatus", "Hipposideros_commersoni", "Hipposideros_gigas", "Hipposideros_thomensis", "Hipposideros_vittatus",  "Hipposideros_armiger", "Hipposideros_turpis"))
, list(c("Hipposideros_khaokhouayensis", "Hipposideros_rotalis", "Hipposideros_ruber", "Hipposideros_cineraceus", "Hipposideros_ater",  "Hipposideros_bicolor", "Hipposideros_dyacorum", "Hipposideros_doriae", "Hipposideros_fulvus", "Hipposideros_calcaratus", "Hipposideros_halophyllus", "Hipposideros_jonesi", "Hipposideros_obscurus", "Hipposideros_pomona", "Hipposideros_ridleyi",  "Hipposideros_orbiculus", "Hipposideros_crumeniferus", "Hipposideros_macrobullatus", "Hipposideros_maggietaylorae", "Hipposideros_marisae", "Hipposideros_nequam",  "Hipposideros_hypophyllus", "Hipposideros_lamottei", "Hipposideros_coronatus", "Hipposideros_durgadasi", "Hipposideros_beatus", "Hipposideros_caffer", "Hipposideros_cervinus", "Hipposideros_coxi", "Hipposideros_fuliginosus", "Hipposideros_galeritus", "Hipposideros_breviceps", "Hipposideros_curtus", "Hipposideros_papua", "Hipposideros_pygmaeus"))), "Hipposideros_megalotis")
#Place Paracoelops as sister to Coelops based on Nature 446, 507-512 (2007)
SisterAnd1(c("Coelops_frithii", "Coelops_hirsutus", "Coelops_robinsoni"), "Paracoelops_megalotis")
#Place Anthops as sister to Asellia, Aselliscus, Cloeotis, Coelops and Hipposideros based on Nature 446, 507-512 (2007)
SisterAnd1(c("Asellia_patrizii", "Asellia_tridens", "Aselliscus_stoliczkanus", "Aselliscus_tricuspidatus", "Cloeotis_percivali", "Coelops_frithii",  "Coelops_robinsoni", "Coelops_hirsutus", "Hipposideros_camerunensis", "Hipposideros_cyclops", "Hipposideros_corynophyllus", "Hipposideros_stenotis",  "Hipposideros_wollastoni", "Hipposideros_muscinus", "Hipposideros_semoni", "Hipposideros_edwardshilli", "Hipposideros_larvatus", "Hipposideros_grandis", "Hipposideros_sumbae", "Hipposideros_madurae", "Hipposideros_sorenseni", "Hipposideros_dinops", "Hipposideros_pelingensis", "Hipposideros_diadema",
 "Hipposideros_inexpectatus", "Hipposideros_lankadiva", "Hipposideros_lekaguli",  "Hipposideros_diadema", "Hipposideros_demissus", "Hipposideros_inornatus", "Hipposideros_commersoni", "Hipposideros_gigas", "Hipposideros_thomensis", "Hipposideros_vittatus",  "Hipposideros_armiger", "Hipposideros_turpis",  "Hipposideros_khaokhouayensis", "Hipposideros_rotalis", "Hipposideros_ruber", "Hipposideros_cineraceus", "Hipposideros_ater",  "Hipposideros_bicolor",  "Hipposideros_dyacorum", "Hipposideros_doriae", "Hipposideros_fulvus", "Hipposideros_calcaratus", "Hipposideros_halophyllus", "Hipposideros_jonesi",
 "Hipposideros_obscurus", "Hipposideros_pomona", "Hipposideros_ridleyi",  "Hipposideros_orbiculus", "Hipposideros_crumeniferus", "Hipposideros_macrobullatus", "Hipposideros_maggietaylorae", "Hipposideros_marisae", "Hipposideros_nequam",  "Hipposideros_hypophyllus", "Hipposideros_lamottei", "Hipposideros_coronatus",  "Hipposideros_durgadasi", "Hipposideros_beatus", "Hipposideros_caffer", "Hipposideros_cervinus", "Hipposideros_coxi", "Hipposideros_fuliginosus", "Hipposideros_galeritus", "Hipposideros_breviceps", "Hipposideros_curtus", "Hipposideros_papua", "Hipposideros_pygmaeus", "Hipposideros_megalotis"), "Anthops_ornatus")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 30 MYA following Meredith et al (2011)
BD.gen(30,0.355)
PHYLO->Hipposideridae

################################################################################################################################################################
###########################################################Megadermatidae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Megadermatidae<-read.tree(text="(Cardioderma_cor:1,(Macroderma_gigas:1,(Megaderma_lyra:1,Megaderma_spasma:1):1):1);")
PHYLO<-Megadermatidae

#Place Lavia as sister to one of the other genera
SisterOrSing1(c("Cardioderma_cor", "Macroderma_gigas", list(c("Megaderma_lyra", "Megaderma_spasma"))), "Lavia_frons")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 26.2 MYA following Bininda-Emonds et al (2007)
YULE.gen(26.2)
PHYLO->Megadermatidae

################################################################################################################################################################
###########################################################Molossidae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Molossidae<-read.tree(text="(Tomopeas_ravus:1,((((Sauromys_petrophilus:1,((Otomops_wroughtoni:1,Otomops_formosus:1):1,(Otomops_madagascariensis:1,Otomops_martiensseni:1):1):1):1,(((Nyctinomops_macrotis:1,(Nyctinomops_aurispinosus:1,(Nyctinomops_femorosaccus:1,Nyctinomops_laticaudatus:1):1):1):1,(Cynomops_abrasus:1,Cynomops_paranus:1):1):1,((Eumops_glaucinus:1,Eumops_underwoodi:1):1,Eumops_perotis:1):1):1):1,(((Tadarida_fulminans:1,Tadarida_teniotis:1):1,(Tadarida_midas:1,(Tadarida_pumila:1,(Tadarida_condylura:1,Tadarida_leucostigma:1):1):1):1):1,((Tadarida_aegyptiaca:1,Tadarida_jobimena:1):1,Tadarida_brasiliensis:1):1):1):1,Mormopterus_jugularis:1):1);")
PHYLO<-Molossidae

#Place the missing genera Molossops, Myopterus and Cheiromeles so Molossops and Cynomops is the sister to Cheiromeles and Myopterus and plave the missing species of Cynomops based on Nature 446, 507-512 (2007)
PHYLO<-drop.tip(PHYLO, "Cynomops_abrasus")
TR<-read.tree(text="((Molossops_aequatorianus:1, Cynomops_paranus:1):1, ((Cheiromeles_torquatus:1,Cheiromeles_parvidens:1):1,(Myopterus_daubentonii:1,Myopterus_whitleyi:1):1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Cynomops_paranus"))
Sister2("Cynomops_paranus", "Cynomops_abrasus", "Cynomops_greenhalli")
Sister1("Cynomops_paranus", "Cynomops_planirostris")
Sister1("Cynomops_greenhalli", "Cynomops_mexicanus")
Sister2("Molossops_aequatorianus", "Molossops_mattogrossensis", "Molossops_neglectus")
Sister1("Molossops_neglectus", "Molossops_temminckii")
#Place missing species of Mormopterus based on Nature 446, 507-512 (2007)
Sister1("Mormopterus_jugularis", "Mormopterus_planiceps")
Sister1("Mormopterus_jugularis", "Mormopterus_kalinowskii")
Sister2("Mormopterus_jugularis", "Mormopterus_doriae", "Mormopterus_acetabulosus")
Sister2("Mormopterus_kalinowskii", "Mormopterus_minutus", "Mormopterus_phrudus")
Sister2( "Mormopterus_planiceps", "Mormopterus_beccarii", "Mormopterus_norfolkensis")
Sister1( "Mormopterus_planiceps", "Mormopterus_loriae")
#Place Platymops as sister to Sauromys or Mormopterus based on Nature 446, 507-512 (2007)
SisterOrSing1(c("Sauromys_petrophilus", list(c("Mormopterus_acetabulosus", "Mormopterus_beccarii", "Mormopterus_doriae", "Mormopterus_jugularis", "Mormopterus_kalinowskii", "Mormopterus_loriae", "Mormopterus_minutus", "Mormopterus_norfolkensis", "Mormopterus_phrudus", "Mormopterus_planiceps"))), "Platymops_setiger")
#Place missing species of Eumops based on Nature 446, 507-512 (2007) and uncertain species status
Sister1("Eumops_perotis", "Eumops_hansae")
Sister1("Eumops_perotis", "Eumops_trumbulli")
SisterAnd1(c("Eumops_underwoodi", "Eumops_glaucinus"), "Eumops_dabbenei") 
SisterAnd1(c("Eumops_underwoodi", "Eumops_glaucinus"), "Eumops_bonariensis")
Sister1( "Eumops_bonariensis", "Eumops_patagonicus")
SisterAnd1(c("Eumops_underwoodi", "Eumops_glaucinus"), "Eumops_maurus")
Sister1("Eumops_underwoodi", "Eumops_auripendulus")
Sister1("Eumops_glaucinus", "Eumops_floridanus")
#Place Molossus as sister to Molossus based on Nature 446, 507-512 (2007)
SisterAnd1(c("Eumops_auripendulus", "Eumops_bonariensis", "Eumops_dabbenei", "Eumops_floridanus", "Eumops_glaucinus", "Eumops_hansae", "Eumops_maurus", "Eumops_patagonicus", "Eumops_perotis", "Eumops_trumbulli", "Eumops_underwoodi"), "Molossus_sinaloae") 
Sister1("Molossus_sinaloae", "Molossus_currentium")
Sister2("Molossus_currentium", "Molossus_molossus", "Molossus_rufus")
Sister1( "Molossus_rufus", "Molossus_pretiosus")
TR<-read.tree(text="(Molossus_molossus:1,Molossus_aztecus:1,Molossus_barnesi:1,Molossus_coibensis:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Molossus_molossus"))
#Place Promops as sister to Eumops and Molossus based on Nature 446, 507-512 (2007)
SisterAnd1(c("Eumops_auripendulus", "Eumops_bonariensis", "Eumops_dabbenei", "Eumops_floridanus", "Eumops_glaucinus", "Eumops_hansae", "Eumops_maurus", "Eumops_patagonicus", "Eumops_perotis", "Eumops_trumbulli", "Eumops_underwoodi", "Molossus_aztecus", "Molossus_barnesi", "Molossus_coibensis", "Molossus_currentium", "Molossus_molossus", "Molossus_pretiosus", "Molossus_rufus", "Molossus_sinaloae"), "Promops_centralis") 
Sister1("Promops_centralis", "Promops_nasutus")
#Place Otomops_papuensis and Otomops_secundus based on Nature 446, 507-512 (2007)
Start<-c("Otomops_formosus", list(c("Otomops_madagascariensis", "Otomops_martiensseni")), "Otomops_wroughtoni")
MIS<-c("Otomops_papuensis", "Otomops_secundus")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Otomops_johnstonei based on taxonomy
SisterOrSing1(c("Otomops_formosus", "Otomops_madagascariensis", "Otomops_martiensseni", "Otomops_wroughtoni", "Otomops_papuensis", "Otomops_secundus"), "Otomops_johnstonei")
#Place missing species of Tadarida based on Nature 446, 507-512 (2007)
SisterOrSing1(c("Tadarida_aegyptiaca", list(c("Tadarida_fulminans", "Tadarida_teniotis"))), "Tadarida_australis")
Sister1("Tadarida_australis", "Tadarida_kuboriensis")
Rep_2_4("Tadarida_fulminans", "Tadarida_teniotis", c("Tadarida_lobata", "Tadarida_ventralis"))
Sister2("Tadarida_teniotis", "Tadarida_insignis", "Tadarida_latouchei")
Rep_2_14ODD("Tadarida_jobimena", "Tadarida_pumila", c("Tadarida_aloysiisabaudiae", "Tadarida_ansorgei", "Tadarida_chapini", "Tadarida_gallagheri", "Tadarida_jobensis", "Tadarida_johorensis", "Tadarida_major", "Tadarida_nigeriae", "Tadarida_plicata", "Tadarida_russata", "Tadarida_tomensis", "BB"))
PHYLO<-drop.tip(PHYLO, "BB")
Sister2("Tadarida_ansorgei", "Tadarida_bemmeleni", "Tadarida_bivittata")
Sister2("Tadarida_johorensis", "Tadarida_bregullae", "Tadarida_solomonis")
SisterOrSing1(c("Tadarida_condylura", "Tadarida_leucostigma", "Tadarida_midas"), "Tadarida_brachyptera")
TR<-read.tree(text="(Tadarida_brachyptera:1,Tadarida_nanula:1,Tadarida_petersoni:1,Tadarida_spurrelli:1, Tadarida_thersites:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Tadarida_brachyptera"))
if  (is.monophyletic(PHYLO, c("Tadarida_leucostigma", "Tadarida_condylura"))==T) {PHYLO<-drop.tip(PHYLO, "Tadarida_condylura"); Rep_2_8("Tadarida_leucostigma", "Tadarida_midas", c("Tadarida_congica", "Tadarida_mops", "Tadarida_niangarae", "Tadarida_sarasinorum", "Tadarida_trevori", "Tadarida_demonstrator")); Sister1("Tadarida_leucostigma", "Tadarida_condylura")} else
Rep_3_9("Tadarida_leucostigma", "Tadarida_condylura", "Tadarida_midas", c("Tadarida_congica", "Tadarida_mops", "Tadarida_niangarae", "Tadarida_sarasinorum", "Tadarida_trevori", "Tadarida_demonstrator"))
Sister1("Tadarida_demonstrator", "Tadarida_niveiventer")

#Simulate potential branch lengths wihtin the family based on a divergence time with its closest relatives of 49.55 MYA following Meredith et al (2011)
#A node called Rootnode_Molossidae is temporarily added but will be deleted when the tree is combined with the remaining families in the order
PHYLO<-bind.tree(read.tree(text="(ROOT_1:1, Rootnode_Molossidae:1);"), PHYLO,1)
BD.gen(49.55,0.355)
PHYLO->Molossidae

################################################################################################################################################################
##############################################################Mormoopidae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Mormoopidae<-read.tree(text="((Mormoops_blainvillei:1,Mormoops_megalophylla:1):1,(((Pteronotus_macleayii:1,Pteronotus_quadridens:1):1,Pteronotus_davyi:1):1,Pteronotus_parnellii:1):1);")
PHYLO<-Mormoopidae
#One of the trees for the genus Pteronotus from the posterior distribution
Pteronotus<-read.tree(text="((((Pteronotus_quadridens:1,Pteronotus_macleayii:1):1,(Pteronotus_davyi:1,Pteronotus_gymnonotus:1):1):1,Pteronotus_parnellii:1):1,Pteronotus_personatus:1);")
MONOP.GROUP<-c("Pteronotus_davyi", "Pteronotus_gymnonotus", "Pteronotus_macleayii", "Pteronotus_paraguanensis", "Pteronotus_parnellii", "Pteronotus_personatus", "Pteronotus_quadridens")
#Merging the family tree with the tree for Pteronotus
Replace.groups(Pteronotus, MONOP.GROUP)

#Place Mormoops_magna based on taxonomy
SisterOrSing1(c("Mormoops_blainvillei", "Mormoops_megalophylla"),  "Mormoops_magna")
#Place Pteronotus_paraguanensis as sister to Pteronotus_parnellii based on uncertain species status
Sister1("Pteronotus_parnellii", "Pteronotus_paraguanensis")

#Simulate potential branch lengths wihtin the family based on a divergence time with its closest relatives of 35.76 MYA following Meredith et al (2011)
#A node called Rootnode_Mormoopidae is temporarily added but will be deleted when the tree is combined with the remaining families in the order
PHYLO<-bind.tree(read.tree(text="(ROOT_1:1, Rootnode_Mormoopidae:1);"), PHYLO,1)
BD.gen(35.76,0.355)
PHYLO->Mormoopidae

################################################################################################################################################################
###########################################################Mystacinidae#########################################################################################
################################################################################################################################################################
#The relationship between the two species in the family
Mystacinidae<-read.tree(text="(Mystacina_tuberculata:1, Mystacina_robusta:1);")
PHYLO<-Mystacinidae

#Simulate potential branch lengths wihtin the family based on a divergence time with its closest relatives of 47.79 MYA following Meredith et al (2011)
#A node called Rootnode_Mystacinidae is temporarily added but will be deleted when the tree is combined with the remaining families in the order
PHYLO<-bind.tree(read.tree(text="(ROOT_1:1, Rootnode_Mystacinidae:1);"), PHYLO,1)
BD.gen(47.79,0.355)
PHYLO->Mystacinidae

################################################################################################################################################################
##############################################################Natalidae#########################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Natalidae<-read.tree(text="(Nyctiellus_lepidus:1,((Natalus_jamaicensis:1,Natalus_major:1):1,(Chilonatalus_tumidifrons:1,Chilonatalus_micropus:1):1):1);")
PHYLO<-Natalidae
#One of the trees for the genus Pteronotus from the posterior distribution
Natalus<-read.tree(text="((Natalus_tumidirostris:1,(Natalus_jamaicensis:1,Natalus_major:1):1):1,Natalus_stramineus:1);")
MONOP.GROUP<-c("Natalus_jamaicensis", "Natalus_major", "Natalus_stramineus", "Natalus_tumidirostris")
#Merging the family tree with the tree for Natalus
Replace.groups(Natalus, MONOP.GROUP)

#Place Natalus_espiritosantensis Natalus_lanatus Natalus_mexicanus and Natalus_primus based on uncertain species status
Rep_3_7("Natalus_jamaicensis", "Natalus_major", "Natalus_stramineus", c("Natalus_espiritosantensis", "Natalus_mexicanus", "Natalus_primus", "Natalus_lanatus"))

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 16 MYA following Meredith et al (2011)
BD.gen(16,0.355)
PHYLO->Natalidae

################################################################################################################################################################
##############################################################Nycteridae########################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Nycteridae<-read.tree(text="((Nycteris_macrotis:1,(Nycteris_javanica:1,Nycteris_grandis:1):1):1,Nycteris_thebaica:1);")
PHYLO<-Nycteridae

#Place missing species of Nycteris based on Nature 446, 507-512 (2007)
Start<-c("Nycteris_grandis", "Nycteris_javanica", "Nycteris_macrotis", "Nycteris_thebaica")
MIS<-c("Nycteris_woodi", "Nycteris_arge")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
TR<-read.tree(text="(Nycteris_arge:1, Nycteris_intermedia:1, Nycteris_major:1, Nycteris_nana:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Nycteris_arge"))
Sister1("Nycteris_woodi", "Nycteris_parisii")
Sister1("Nycteris_grandis", "Nycteris_hispida")
Sister1("Nycteris_hispida", "Nycteris_aurita")
Sister1("Nycteris_javanica", "Nycteris_tragata")
Sister2("Nycteris_macrotis", "Nycteris_vinsoni", "Nycteris_madagascariensis")
Sister1("Nycteris_thebaica", "Nycteris_gambiensis")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 12.1 MYA following Bininda-Emonds et al (2007)
BD.gen(12.1,0.355)
PHYLO->Nycteridae

################################################################################################################################################################
##############################################################Phyllostomidae####################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Phyllostomidae<-read.tree(text="(((((Micronycteris_megalotis:1,Micronycteris_microtis:1):1,Micronycteris_hirsuta:1):1,(Micronycteris_minuta:1,Micronycteris_schmidtorum:1):1):1,Lampronycteris_brachyotis:1):1,((Macrotus_californicus:1,Macrotus_waterhousii:1):1,(((Desmodus_rotundus:1,Diaemus_youngi:1):1,Diphylla_ecaudata:1):1,((((Anoura_geoffroyi:1,((((Choeroniscus_godmani:1,Choeronycteris_mexicana:1):1,Musonycteris_harrisoni:1):1,Lichonycteris_obscura:1):1,Hylonycteris_underwoodi:1):1):1,((Monophyllus_redmani:1,((Leptonycteris_yerbabuenae:1,Leptonycteris_curasoae:1):1,Glossophaga_soricina:1):1):1,((Phyllonycteris_poeyi:1,(Brachyphylla_nana:1,Brachyphylla_cavernarum:1):1):1,(Phyllonycteris_aphylla:1,(Erophylla_bombifrons:1,Erophylla_sezekorni:1):1):1):1):1):1,((Lonchorhina_aurita:1,((Lonchophylla_robusta:1,(Lionycteris_spurrelli:1,Platalina_genovensium:1):1):1,Lonchophylla_thomasi:1):1):1,((((((((Uroderma_bilobatum:1,Uroderma_magnirostrum:1):1,((Platyrrhinus_lineatus:1,(Platyrrhinus_recifinus:1,(Platyrrhinus_helleri:1,Platyrrhinus_matapalensis:1):1):1):1,(Platyrrhinus_brachycephalus:1,(((Platyrrhinus_ismaeli:1,Platyrrhinus_masu:1):1,((Platyrrhinus_infuscus:1,Platyrrhinus_nigellus:1):1,((Platyrrhinus_aurarius:1,Vampyrodes_caraccioli:1):1,Platyrrhinus_dorsalis:1):1):1):1,Platyrrhinus_vittatus:1):1):1):1):1,(Mesophylla_macconnelli:1,(Vampyressa_pusilla:1,Vampyressa_melissa:1):1):1):1,(Chiroderma_villosum:1,Vampyressa_bidens:1):1):1,(Enchisthenes_hartii:1,(Ectophylla_alba:1,(((Phyllops_falcatus:1,Stenoderma_rufum:1):1,((Ardops_nichollsi:1,Ariteus_flavescens:1):1,(Pygoderma_bilabiatum:1,((Ametrida_centurio:1,Sphaeronycteris_toxophyllum:1):1,Centurio_senex:1):1):1):1):1,(((Artibeus_hirsutus:1,(Artibeus_jamaicensis:1,Artibeus_lituratus:1):1):1,Artibeus_concolor:1):1,Artibeus_cinereus:1):1):1):1):1):1,((Sturnira_tildae:1,Sturnira_lilium:1):1,Sturnira_erythromos:1):1):1,(Rhinophylla_alethina:1,(Rhinophylla_fischerae:1,Rhinophylla_pumilio:1):1):1):1,((Trinycteris_nicefori:1,(Glyphonycteris_daviesi:1,Glyphonycteris_sylvestris:1):1):1,Carollia_brevicauda:1):1):1):1):1,(((Macrophyllum_macrophyllum:1,Trachops_cirrhosus:1):1,(((Tonatia_saurophila:1,Tonatia_bidens:1):1,Phyllostomus_discolor:1):1,((Phyllostomus_hastatus:1,(Mimon_crenulatum:1,Phylloderma_stenops:1):1):1,((Lophostoma_evotis:1,Lophostoma_silvicolum:1):1,(Lophostoma_brasiliense:1,Lophostoma_schulzi:1):1):1):1):1):1,(Chrotopterus_auritus:1,Vampyrum_spectrum:1):1):1):1):1):1);")
PHYLO<-Phyllostomidae
#One of the trees for the genus Artibeus from the posterior distribution
Artibeus<-read.tree(text="(Artibeus_concolor:1,(((Artibeus_inopinatus:1,(Artibeus_hirsutus:1,Artibeus_fraterculus:1):1):1,(Artibeus_fimbriatus:1,((Artibeus_lituratus:1,((Artibeus_amplus:1,Artibeus_planirostris:1):1,Artibeus_obscurus:1):1):1,Artibeus_jamaicensis:1):1):1):1,(((Artibeus_phaeotis:1,Artibeus_toltecus:1):1,((((Artibeus_gnomus:1,Artibeus_glaucus:1):1,Artibeus_anderseni:1):1,Artibeus_cinereus:1):1,Artibeus_aztecus:1):1):1,(Artibeus_incomitatus:1,Artibeus_watsoni:1):1):1):1);")
MONOP.GROUP<-c("Artibeus_cinereus", "Artibeus_concolor", "Artibeus_hirsutus", "Artibeus_jamaicensis", "Artibeus_lituratus", "Artibeus_amplus", "Artibeus_anderseni", "Artibeus_aztecus", "Artibeus_fimbriatus", "Artibeus_fraterculus", "Artibeus_glaucus", "Artibeus_gnomus", "Artibeus_incomitatus", "Artibeus_inopinatus", "Artibeus_obscurus", "Artibeus_phaeotis", "Artibeus_planirostris", "Artibeus_toltecus", "Artibeus_watsoni")
#Merging the family tree with the tree for Artibeus
Replace.groups(Artibeus, MONOP.GROUP)
#One of the trees for the genus Carollia from the posterior distribution
Carollia<-read.tree(text="(Carollia_castanea:1,((Carollia_brevicauda:1,(Carollia_subrufa:1,Carollia_sowelli:1):1):1,Carollia_perspicillata:1):1);")
MONOP.GROUP<-c("Carollia_brevicauda", "Carollia_castanea", "Carollia_perspicillata", "Carollia_sowelli", "Carollia_subrufa")
#Merging the family tree with the tree for Carollia
Replace.groups(Carollia, MONOP.GROUP)
#One of the trees for the genus Chiroderma from the posterior distribution
Chiroderma<-read.tree(text="((Chiroderma_improvisum:1,Chiroderma_villosum:1):1,((Chiroderma_trinitatum:1,Chiroderma_doriae:1):1,Chiroderma_salvini:1):1);")
MONOP.GROUP<-c("Chiroderma_doriae", "Chiroderma_improvisum", "Chiroderma_salvini", "Chiroderma_trinitatum", "Chiroderma_villosum")
#Merging the family tree with the tree for Chiroderma
Replace.groups(Chiroderma, MONOP.GROUP)
#One of the trees for the genus Glossophaga from the posterior distribution
Glossophaga<-read.tree(text="((Glossophaga_leachii:1,(Glossophaga_commissarisi:1,Glossophaga_soricina:1):1):1,Glossophaga_longirostris:1);")
MONOP.GROUP<-c("Glossophaga_soricina", "Glossophaga_commissarisi", "Glossophaga_leachii", "Glossophaga_longirostris")
#Merging the family tree with the tree for Glossophaga
Replace.groups(Glossophaga, MONOP.GROUP)
#One of the trees for the genus Lonchorhina from the posterior distribution
Lonchorhina<-read.tree(text="(Lonchorhina_orinocensis:1,(Lonchorhina_aurita:1,Lonchorhina_inusitata:1):1);")
MONOP.GROUP<-c("Lonchorhina_aurita", "Lonchorhina_inusitata", "Lonchorhina_orinocensis")
#Merging the family tree with the tree for Lonchorhina
Replace.groups(Lonchorhina, MONOP.GROUP)
#One of the trees for the genus Lophostoma from the posterior distribution
Lophostoma<-read.tree(text="(Lophostoma_carrikeri:1,(Lophostoma_brasiliense:1,((Lophostoma_silvicolum:1,Lophostoma_evotis:1):1,Lophostoma_schulzi:1):1):1);")
MONOP.GROUP<-c("Lophostoma_brasiliense", "Lophostoma_carrikeri", "Lophostoma_evotis", "Lophostoma_schulzi", "Lophostoma_silvicolum")
#Merging the family tree with the tree for Lophostoma
Replace.groups(Lophostoma, MONOP.GROUP)
#One of the trees for the genus Micronycteris from the posterior distribution
Micronycteris<-read.tree(text="((((Micronycteris_megalotis:1,(Micronycteris_matses:1,Micronycteris_microtis:1):1):1,Micronycteris_brosseti:1):1,(Micronycteris_minuta:1,Micronycteris_schmidtorum:1):1):1,Micronycteris_hirsuta:1);")
MONOP.GROUP<-c("Micronycteris_hirsuta", "Micronycteris_megalotis", "Micronycteris_microtis", "Micronycteris_minuta", "Micronycteris_schmidtorum", "Micronycteris_brosseti", "Micronycteris_matses")
#Merging the family tree with the tree for Micronycteris
Replace.groups(Micronycteris, MONOP.GROUP)
#One of the trees for the genus Mimon from the posterior distribution
Mimon<-read.tree(text="(Mimon_crenulatum:1,(Mimon_bennettii:1,Mimon_cozumelae:1):1);")
MONOP.GROUP<-c("Mimon_bennettii", "Mimon_cozumelae", "Mimon_crenulatum")
#Merging the family tree with the tree for Mimon
Replace.groups(Mimon, MONOP.GROUP)
#One of the trees for the genus Phyllostomus from the posterior distribution
Phyllostomus<-read.tree(text="(Phyllostomus_discolor:1,(Phyllostomus_latifolius:1,(Phyllostomus_hastatus:1,Phyllostomus_elongatus:1):1):1);")
MONOP.GROUP<-c("Phyllostomus_discolor", "Phyllostomus_elongatus", "Phyllostomus_hastatus", "Phyllostomus_latifolius")
#Merging the family tree with the tree for Phyllostomus
Replace.groups(Phyllostomus, MONOP.GROUP)
#One of the trees for the genus Platyrrhinus from the posterior distribution
Platyrrhinus<-read.tree(text="((((Platyrrhinus_matapalensis:1,Platyrrhinus_helleri:1):1,(Platyrrhinus_lineatus:1,Platyrrhinus_recifinus:1):1):1,(Platyrrhinus_aurarius:1,(Platyrrhinus_infuscus:1,((Platyrrhinus_nigellus:1,((Platyrrhinus_albericoi:1,Platyrrhinus_vittatus:1):1,(Platyrrhinus_masu:1,Platyrrhinus_ismaeli:1):1):1):1,Platyrrhinus_dorsalis:1):1):1):1):1,Platyrrhinus_brachycephalus:1);")
MONOP.GROUP<-c("Platyrrhinus_albericoi", "Platyrrhinus_aurarius", "Platyrrhinus_brachycephalus", "Platyrrhinus_dorsalis", "Platyrrhinus_helleri", "Platyrrhinus_infuscus", "Platyrrhinus_ismaeli", "Platyrrhinus_lineatus", "Platyrrhinus_masu", "Platyrrhinus_matapalensis", "Platyrrhinus_nigellus", "Platyrrhinus_recifinus", "Platyrrhinus_vittatus")
#Merging the family tree with the tree for Platyrrhinus
Replace.groups(Platyrrhinus, MONOP.GROUP)
#One of the trees for the genus Sturnira from the posterior distribution
Sturnira<-read.tree(text="(((((Sturnira_erythromos:1,Sturnira_luisi:1):1,((Sturnira_bogotensis:1,(Sturnira_tildae:1,Sturnira_lilium:1):1):1,((Sturnira_ludovici:1,Sturnira_oporaphilum:1):1,Sturnira_mordax:1):1):1):1,Sturnira_aratathomasi:1):1,Sturnira_nana:1):1,Sturnira_bidens:1);")
MONOP.GROUP<-c("Sturnira_erythromos", "Sturnira_lilium", "Sturnira_tildae", "Sturnira_aratathomasi", "Sturnira_bidens", "Sturnira_bogotensis", "Sturnira_ludovici", "Sturnira_luisi", "Sturnira_mordax", "Sturnira_nana", "Sturnira_oporaphilum")
#Merging the family tree with the tree for Sturnira
Replace.groups(Sturnira, MONOP.GROUP)
#One of the trees for the genus Vampyressa from the posterior distribution
Vampyressa<-read.tree(text="((Vampyressa_thyone:1,(Vampyressa_melissa:1,Vampyressa_pusilla:1):1):1,(Vampyressa_bidens:1,(Vampyressa_brocki:1,Vampyressa_nymphaea:1):1):1);")
MONOP.GROUP<-c("Vampyressa_bidens", "Vampyressa_brocki", "Vampyressa_melissa", "Vampyressa_nymphaea", "Vampyressa_pusilla", "Vampyressa_thyone")
#Merging the family tree with the tree for Vampyressa
Replace.groups(Vampyressa, MONOP.GROUP)

#Temporarily add a taxon named B to handle placements near the root of the family tree
TR<-read.tree(text="(A:1, B:1):1;")
PHYLO<<-bind.tree(TR , PHYLO,  1)

#Place missing species of Sturnira based on taxonomy
Start<-c("Sturnira_aratathomasi", "Sturnira_bidens", "Sturnira_bogotensis", "Sturnira_erythromos", "Sturnira_lilium", "Sturnira_ludovici", "Sturnira_luisi", "Sturnira_mordax", "Sturnira_nana", "Sturnira_oporaphilum", "Sturnira_tildae")
MIS<-c("Sturnira_magna", "Sturnira_mistratensis", "Sturnira_sorianoi", "Sturnira_thomasi")
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place missing species of Lophostoma based on taxonomy
Start<-c("Lophostoma_brasiliense", "Lophostoma_carrikeri", "Lophostoma_evotis", "Lophostoma_schulzi", "Lophostoma_silvicolum")
MIS<-c( "Lophostoma_aequatorialis" ,  "Lophostoma_yasuni" )
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Artibeus_anthonyi based on taxonomy
SisterOrSing1(c("Artibeus_amplus", "Artibeus_anderseni", "Artibeus_aztecus", "Artibeus_cinereus", "Artibeus_concolor", "Artibeus_fimbriatus", "Artibeus_fraterculus", "Artibeus_glaucus", "Artibeus_gnomus", "Artibeus_hirsutus",  "Artibeus_incomitatus", "Artibeus_inopinatus", "Artibeus_jamaicensis", "Artibeus_lituratus", "Artibeus_obscurus", "Artibeus_phaeotis", "Artibeus_planirostris", "Artibeus_toltecus", "Artibeus_watsoni"), "Artibeus_anthonyi")
#Place Artibeus_rosenbergii based on uncertain species status
Sister1("Artibeus_glaucus", "Artibeus_rosenbergii")
#Place missing species of Anoura based on taxonomy
TR<-read.tree(text="(Anoura_caudifer:1, Anoura_cultrata:1, Anoura_fistulata:1, Anoura_geoffroyi:1, Anoura_latidens:1, Anoura_luismanueli:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Anoura_geoffroyi"))
#Place missing species of Choeroniscus based on taxonomy
Sister2("Choeroniscus_godmani", "Choeroniscus_minor", "Choeroniscus_periosus")
#Place missing species of Desmodus based on taxonomy
TR<-read.tree(text="(Desmodus_rotundus:1, Desmodus_draculae:1, Desmodus_puntajudensis:1, Desmodus_stocki:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Desmodus_rotundus"))
#Place Glyphonycteris_behnii based on Nature 446, 507-512 (2007)
Sister1("Glyphonycteris_sylvestris", "Glyphonycteris_behnii")
#Place Leptonycteris_nivalis based on Nature 446, 507-512 (2007)
SisterAnd1(c("Leptonycteris_curasoae", "Leptonycteris_yerbabuenae"), "Leptonycteris_nivalis")
#Place Monophyllus_plethodon based on taxonomy
Sister1("Monophyllus_redmani", "Monophyllus_plethodon")
#Place Phyllonycteris_major based on Nature 446, 507-512 (2007)
Sister1("Phyllonycteris_poeyi", "Phyllonycteris_major")
#Place Phyllops_silvai based on taxonomy
Sister1("Phyllops_falcatus", "Phyllops_silvai")
#Place missing species of Platyrrhinus based on taxonomy
Start<-c("Platyrrhinus_aurarius", "Platyrrhinus_brachycephalus", "Platyrrhinus_dorsalis", "Platyrrhinus_helleri", "Platyrrhinus_infuscus", "Platyrrhinus_ismaeli", "Platyrrhinus_lineatus", "Platyrrhinus_masu", "Platyrrhinus_matapalensis", "Platyrrhinus_nigellus", "Platyrrhinus_recifinus", "Platyrrhinus_vittatus")
MIS<-c("Platyrrhinus_chocoensis", "Platyrrhinus_umbratus")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Carollia_manu based on taxonomy
SisterOrSing1(c("Carollia_brevicauda", "Carollia_castanea", "Carollia_perspicillata", "Carollia_sowelli", "Carollia_subrufa"), "Carollia_manu")
#Place Glossophaga_morenoi based on Nature 446, 507-512 (2007)
SisterOrSing1(c("Glossophaga_leachii", "Glossophaga_longirostris"), "Glossophaga_morenoi")
#Place missing species of Lonchorhina based on taxonomy
Start<-c("Lonchorhina_aurita", "Lonchorhina_inusitata", "Lonchorhina_orinocensis") 
MIS<-c("Lonchorhina_fernandezi", "Lonchorhina_marinkellei")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Micronycteris_sanborni based on taxonomy
SisterOrSing1(c("Micronycteris_brosseti", "Micronycteris_hirsuta", "Micronycteris_matses", "Micronycteris_megalotis", "Micronycteris_microtis", "Micronycteris_minuta", "Micronycteris_schmidtorum"),"Micronycteris_sanborni")
#Place Mimon_koepckeae based on Nature 446, 507-512 (2007)
Sister1( "Mimon_crenulatum", "Mimon_koepckeae")
#Place Neonycteris as sister to Glyphonycteris based on Nature 446, 507-512 (2007)
SisterAnd1(c("Glyphonycteris_behnii", "Glyphonycteris_daviesi", "Glyphonycteris_sylvestris"), "Neonycteris_pusilla")
#Place Scleronycteris as sister to Hylonycteris and Lichonycteris based on Nature 446, 507-512 (2007)
SisterAnd1(c("Hylonycteris_underwoodi", "Lichonycteris_obscura"), "Scleronycteris_ega")
#Place Xeronycteris_vieirai as sister to Platalina_genovensium based on IUCN
Sister1("Platalina_genovensium", "Xeronycteris_vieirai")
#Place missing species of Lonchophylla based on taxonomy
Rep_2_10("Lonchophylla_robusta", "Lonchophylla_thomasi", c("Lonchophylla_bokermanni", "Lonchophylla_chocoana", "Lonchophylla_concava", "Lonchophylla_dekeyseri", "Lonchophylla_handleyi", "Lonchophylla_hesperia", "Lonchophylla_mordax", "Lonchophylla_orcesi"))
#Delete temporary taxon B
PHYLO<<-drop.tip(PHYLO, "B")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 34 MYA following Datzmann et al (2010)
BD.gen(34,0.355)
PHYLO->Phyllostomidae

################################################################################################################################################################
##############################################################Pteropodidae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Pteropodidae<-read.tree(text="(((Notopteris_macdonaldi:1,(Nyctimene_vizcaccia:1,(Nyctimene_robinsoni:1,Nyctimene_cephalotes:1):1):1):1,(((((((Cynopterus_brachyotis:1,Cynopterus_sphinx:1):1,(Megaerops_ecaudatus:1,Megaerops_kusnotoi:1):1):1,Ptenochirus_jagori:1):1,((((Balionycteris_maculata:1,Aethalops_alecto:1):1,((((Penthetor_lucasi:1,Thoopterus_nigrescens:1):1,Chironax_melanocephalus:1):1,Latidens_salimalii:1):1,(Alionycteris_paucidentata:1,(Haplonycteris_fischeri:1,Otopteropus_cartilagonodus:1):1):1):1):1,Sphaerias_blanfordi:1):1,Dyacopterus_spadiceus:1):1):1,(((Aproteles_bulmerae:1,((Harpyionycteris_celebensis:1,Harpyionycteris_whiteheadi:1):1,((Dobsonia_moluccensis:1,(Dobsonia_inermis:1,Dobsonia_praedatrix:1):1):1,Dobsonia_minor:1):1):1):1,Rousettus_bidens:1):1,(((Rousettus_amplexicaudatus:1,((Rousettus_madagascariensis:1,Rousettus_leschenaultii:1):1,Rousettus_aegyptiacus:1):1):1,((((Megaloglossus_woermanni:1,(Myonycteris_torquata:1,Lissonycteris_angolensis:1):1):1,Rousettus_lanosus:1):1,(Hypsignathus_monstrosus:1,(((Epomophorus_wahlbergi:1,Micropteropus_pusillus:1):1,Nanonycteris_veldkampii:1):1,Epomops_franqueti:1):1):1):1,(Eonycteris_robusta:1,Eonycteris_spelaea:1):1):1):1,(Scotonycteris_zenkeri:1,Casinycteris_argynnis:1):1):1):1):1,(Syconycteris_australis:1,(Macroglossus_minimus:1,Macroglossus_sobrinus:1):1):1):1,((Melonycteris_melanops:1,Melonycteris_fardoulisi:1):1,(((Acerodon_celebensis:1,((Pteropus_molossinus:1,Pteropus_woodfordi:1):1,((((Pteropus_tonganus:1,(Pteropus_mariannus:1,(Pteropus_conspicillatus:1,Pteropus_alecto:1):1):1):1,Pteropus_neohibernicus:1):1,(Pteropus_temminckii:1,(Pteropus_anetianus:1,Pteropus_samoensis:1):1):1):1,(((Pteropus_vampyrus:1,(Pteropus_lylei:1,Pteropus_giganteus:1):1):1,Pteropus_pumilus:1):1,Pteropus_poliocephalus:1):1):1):1):1,Styloctenium_wallacei:1):1,(Pteralopex_atrata:1,Mirimiri_acrodonta:1):1):1):1):1):1,(Eidolon_helvum:1,Pteropus_leucopterus:1):1);")
PHYLO<-Pteropodidae
#Temporarily add a taxon named B to handle placements near the root of the family tree
TR<-read.tree(text="(A:1, B:1):1;")
PHYLO<<-bind.tree(TR , PHYLO,  1)
#One of the trees for the genus Eonycteris from the posterior distribution
Eonycteris<-read.tree(text="((Eonycteris_robusta:1,Eonycteris_major:1):1,Eonycteris_spelaea:1);")
MONOP.GROUP<-c("Eonycteris_major", "Eonycteris_robusta", "Eonycteris_spelaea")
#Merging the family tree with the tree for Eonycteris
Replace.groups(Eonycteris, MONOP.GROUP)
#One of the trees for the genus Megaerops from the posterior distribution
Megaerops<-read.tree(text="((Megaerops_ecaudatus:1,(Megaerops_kusnotoi:1,Megaerops_niphanae:1):1):1,Megaerops_wetmorei:1);")
MONOP.GROUP<-c("Megaerops_ecaudatus", "Megaerops_kusnotoi", "Megaerops_niphanae", "Megaerops_wetmorei")
#Merging the family tree with the tree for Megaerops
Replace.groups(Megaerops, MONOP.GROUP)
#One of the trees for the genus Melonycteris from the posterior distribution
Melonycteris<-read.tree(text="(Melonycteris_melanops:1,(Melonycteris_woodfordi:1,Melonycteris_fardoulisi:1):1);")
MONOP.GROUP<-c("Melonycteris_fardoulisi", "Melonycteris_melanops", "Melonycteris_woodfordi")
#Merging the family tree with the tree for Melonycteris
Replace.groups(Melonycteris, MONOP.GROUP)
#One of the trees for the genus Myonycteris from the posterior distribution
Myonycteris<-read.tree(text="((Myonycteris_torquata:1,Myonycteris_brachycephala:1):1,Myonycteris_relicta:1);")
MONOP.GROUP<-c("Myonycteris_brachycephala", "Myonycteris_relicta", "Myonycteris_torquata")
#Merging the family tree with the tree for Myonycteris
Replace.groups(Myonycteris, MONOP.GROUP)
#One of the trees for the genus Pteropus from the posterior distribution
Pteropus<-read.tree(text="((Pteropus_leucopterus:1,(((((Pteropus_vetulus:1,(((Pteropus_capistratus:1,Pteropus_poliocephalus:1):1,(Pteropus_temminckii:1,((((Pteropus_rayneri:1,Pteropus_fundatus:1):1,Pteropus_cognatus:1):1,Pteropus_samoensis:1):1,Pteropus_anetianus:1):1):1):1,Pteropus_ornatus:1):1):1,((((((Pteropus_aldabrensis:1,(Pteropus_rufus:1,(Pteropus_niger:1,Pteropus_seychellensis:1):1):1):1,(Pteropus_lylei:1,Pteropus_giganteus:1):1):1,Pteropus_rodricensis:1):1,Pteropus_vampyrus:1):1,(Pteropus_dasymallus:1,Pteropus_pumilus:1):1):1,(Pteropus_livingstonii:1,Pteropus_voeltzkowi:1):1):1):1,((((Pteropus_alecto:1,Pteropus_conspicillatus:1):1,(Pteropus_hypomelanus:1,Pteropus_speciosus:1):1):1,(Pteropus_tonganus:1,(Pteropus_pohlei:1,Pteropus_mariannus:1):1):1):1,Pteropus_neohibernicus:1):1):1,Pteropus_scapulatus:1):1,(Pteropus_woodfordi:1,Pteropus_molossinus:1):1):1):1,Pteropus_personatus:1);")
MONOP.GROUP<-c("Pteropus_alecto", "Pteropus_anetianus", "Pteropus_conspicillatus", "Pteropus_giganteus", "Pteropus_leucopterus", "Pteropus_lylei", "Pteropus_mariannus", "Pteropus_molossinus", "Pteropus_neohibernicus", "Pteropus_poliocephalus", "Pteropus_pumilus", "Pteropus_samoensis", "Pteropus_temminckii", "Pteropus_tonganus", "Pteropus_vampyrus", "Pteropus_woodfordi", "Pteropus_aldabrensis", "Pteropus_capistratus", "Pteropus_cognatus", "Pteropus_dasymallus", "Pteropus_fundatus", "Pteropus_hypomelanus", "Pteropus_livingstonii", "Pteropus_niger", "Pteropus_ornatus", "Pteropus_personatus", "Pteropus_pohlei", "Pteropus_rayneri", "Pteropus_rodricensis", "Pteropus_rufus", "Pteropus_scapulatus", "Pteropus_seychellensis", "Pteropus_speciosus", "Pteropus_vetulus")
#Merging the family tree with the tree for Pteropus
Replace.groups(Pteropus, MONOP.GROUP)
#One of the trees for the genus Rousettus from the posterior distribution
Rousettus<-read.tree(text="((Rousettus_aegyptiacus:1,Rousettus_lanosus:1):1,((((Rousettus_obliviosus:1,Rousettus_leschenaultii:1):1,Rousettus_madagascariensis:1):1,(Rousettus_spinalatus:1,Rousettus_amplexicaudatus:1):1):1,Rousettus_bidens:1):1);")
MONOP.GROUP<-c("Rousettus_aegyptiacus", "Rousettus_amplexicaudatus", "Rousettus_bidens", "Rousettus_lanosus", "Rousettus_leschenaultii", "Rousettus_madagascariensis", "Rousettus_obliviosus", "Rousettus_spinalatus")
#Merging the family tree with the tree for Rousettus
Replace.groups(Rousettus, MONOP.GROUP)

#Place missing species of Acerodon based on taxonomy
TR<-read.tree(text="(Acerodon_celebensis:1 , Acerodon_humilis:1,  Acerodon_jubatus:1 , Acerodon_leucotis:1 , Acerodon_mackloti:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Acerodon_celebensis"))
#Place Aethalops_aequalis based on taxonomy
Sister1("Aethalops_alecto", "Aethalops_aequalis")
#Place missing species of Cynopterus based Nature 446, 507-512 (2007)
SisterAnd1(c("Cynopterus_brachyotis", "Cynopterus_sphinx"), "Cynopterus_nusatenggara")
Sister2("Cynopterus_brachyotis", "Cynopterus_luzoniensis", "Cynopterus_minutus")
TR<-read.tree(text="(Cynopterus_nusatenggara:1,(Cynopterus_horsfieldii:1,Cynopterus_titthaecheilus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Cynopterus_nusatenggara"))
#Place missing species of Dobsonia based Nature 446, 507-512 (2007)
if  (is.monophyletic(PHYLO, c("Dobsonia_praedatrix", "Dobsonia_inermis"))==T) {PHYLO<-drop.tip(PHYLO, "Dobsonia_inermis"); Rep_3_7("Dobsonia_minor", "Dobsonia_praedatrix", "Dobsonia_moluccensis", c("Dobsonia_peronii", "Dobsonia_emersa", "Dobsonia_exoleta", "Dobsonia_pannietensis"))
TR<-read.tree(text="(Dobsonia_beauforti:1, Dobsonia_inermis:1, Dobsonia_praedatrix:1, (Dobsonia_viridis:1, Dobsonia_crenulata:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Dobsonia_praedatrix"))} else 
{Rep_4_8("Dobsonia_minor", "Dobsonia_praedatrix", "Dobsonia_moluccensis", "Dobsonia_inermis", c("Dobsonia_peronii", "Dobsonia_emersa", "Dobsonia_exoleta", "Dobsonia_pannietensis"))
Rep_2_4("Dobsonia_praedatrix", "Dobsonia_inermis", c("Dobsonia_beauforti", "Dobsonia_viridis"))
Sister1("Dobsonia_viridis", "Dobsonia_crenulata")}
Sister1("Dobsonia_moluccensis",  "Dobsonia_anderseni")
SisterOrSing1(c("Dobsonia_anderseni", "Dobsonia_beauforti", "Dobsonia_crenulata", "Dobsonia_emersa", "Dobsonia_exoleta", "Dobsonia_inermis", "Dobsonia_minor", "Dobsonia_moluccensis", "Dobsonia_pannietensis", "Dobsonia_peronii", "Dobsonia_praedatrix", "Dobsonia_viridis"), "Dobsonia_chapmani")
#Place Dyacopterus_brooksi based on taxonomy
Sister1("Dyacopterus_spadiceus", "Dyacopterus_brooksi")
#Place Eidolon_dupreanum based on taxonomy
Sister1("Eidolon_helvum", "Eidolon_dupreanum")
#Place missing species of Epomophorus based Nature 446, 507-512 (2007)
TR<-read.tree(text="(Epomophorus_wahlbergi:1, (Epomophorus_angolensis:1, (Epomophorus_gambianus:1, Epomophorus_crypturus:1 ):1, Epomophorus_grandis:1, Epomophorus_labiatus:1, Epomophorus_anselli:1, Epomophorus_minimus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Epomophorus_wahlbergi"))
#Place missing species of Epomops based on taxonomy
Sister2("Epomops_franqueti",  "Epomops_buettikoferi", "Epomops_dobsonii")
#Place Micropteropus_intermedius based on taxonomy
Sister1("Micropteropus_pusillus", "Micropteropus_intermedius")
#Place Notopteris_neocaledonica based on taxonomy
Sister1("Notopteris_macdonaldi", "Notopteris_neocaledonica")
#Place Ptenochirus_minor based on taxonomy
Sister1("Ptenochirus_jagori", "Ptenochirus_minor")
#Place Scotonycteris_ophiodon based on taxonomy
Sister1("Scotonycteris_zenkeri", "Scotonycteris_ophiodon")
#Place Styloctenium_mindorensis based on taxonomy
Sister1( "Styloctenium_wallacei", "Styloctenium_mindorensis")
#Place missing species of Syconycteris based on taxonomy
Sister2("Syconycteris_australis", "Syconycteris_carolinae", "Syconycteris_hobbit")
#Place missing species of Nyctimene based on Nature 446, 507-512 (2007)
if  (is.monophyletic(PHYLO, c("Nyctimene_cephalotes", "Nyctimene_vizcaccia"))==T) {PHYLO<-drop.tip(PHYLO, "Nyctimene_vizcaccia")
Rep_2_5("Nyctimene_cephalotes", "Nyctimene_robinsoni", c("Nyctimene_aello", "Nyctimene_certans", "Nyctimene_albiventer"))
TR<-read.tree(text="(Nyctimene_cephalotes:1, Nyctimene_rabori:1, Nyctimene_malaitensis:1, Nyctimene_masalai:1, Nyctimene_vizcaccia:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Nyctimene_cephalotes"))} else
 {Rep_3_6("Nyctimene_cephalotes", "Nyctimene_vizcaccia", "Nyctimene_robinsoni", c("Nyctimene_aello", "Nyctimene_certans", "Nyctimene_albiventer"))
Rep_2_5("Nyctimene_cephalotes", "Nyctimene_vizcaccia", c("Nyctimene_rabori",  "Nyctimene_malaitensis", "Nyctimene_masalai"))}
Sister1("Nyctimene_certans", "Nyctimene_cyclotis")
Sister2("Nyctimene_albiventer", "Nyctimene_draconilla", "Nyctimene_minutus")
Sister1("Nyctimene_robinsoni", "Nyctimene_major")
Start<-c("Nyctimene_aello", "Nyctimene_albiventer", "Nyctimene_cephalotes", "Nyctimene_certans", "Nyctimene_cyclotis", "Nyctimene_draconilla", "Nyctimene_major", "Nyctimene_malaitensis", "Nyctimene_masalai", "Nyctimene_minutus", "Nyctimene_rabori", "Nyctimene_robinsoni", "Nyctimene_vizcaccia")
MIS<-c("Nyctimene_keasti", "Nyctimene_sanctacrucis")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place missing species of Pteralopex based on taxonomy
TR<-read.tree(text="(Pteralopex_anceps:1, Pteralopex_atrata:1, Pteralopex_pulchra:1, Pteralopex_taki:1, Pteralopex_flanneryi:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Pteralopex_atrata"))
#Place missing species of Rousettus based on Nature 446, 507-512 (2007)
Start<-c("Rousettus_aegyptiacus", "Rousettus_amplexicaudatus", "Rousettus_leschenaultii", "Rousettus_obliviosus", "Rousettus_spinalatus")
MIS<-c("Rousettus_celebensis", "Rousettus_linduensis")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Paranyctimene as sister to Nyctimene based on Nature 446, 507-512 (2007)
SisterAnd1( c("Nyctimene_aello", "Nyctimene_albiventer", "Nyctimene_cephalotes", "Nyctimene_certans", "Nyctimene_cyclotis", "Nyctimene_draconilla", "Nyctimene_major", "Nyctimene_malaitensis", "Nyctimene_masalai", "Nyctimene_minutus", "Nyctimene_rabori", "Nyctimene_robinsoni", "Nyctimene_vizcaccia", "Nyctimene_keasti", "Nyctimene_sanctacrucis"), "Paranyctimene_raptor")
Sister1("Paranyctimene_raptor", "Paranyctimene_tenax")
#Place Plerotes as sister to Casinycteris, Scotonycteris, Nanonycteris, Hypsignathus, Epomops, Micropteropus and Epomophorus based on Nature 446, 507-512 (2007)
SisterAnd1(c("Casinycteris_argynnis", "Scotonycteris_ophiodon", "Scotonycteris_zenkeri", "Nanonycteris_veldkampii", "Hypsignathus_monstrosus", "Epomops_buettikoferi", "Epomops_dobsonii", "Epomops_franqueti", "Micropteropus_intermedius", "Micropteropus_pusillus", "Epomophorus_wahlbergi", "Epomophorus_angolensis", "Epomophorus_gambianus", "Epomophorus_crypturus", "Epomophorus_grandis", "Epomophorus_labiatus", "Epomophorus_anselli", "Epomophorus_minimus"), "Plerotes_anchietae")
#Place Neopteryxas sister to Styloctenium based on Nature 446, 507-512 (2007)
SisterAnd1( c("Styloctenium_wallacei", "Styloctenium_mindorensis"), "Neopteryx_frosti")
#Place most missing species of Pteropus based on Nature 446, 507-512 (2007)
SisterOrSing1(c ("Pteropus_pohlei",  "Pteropus_poliocephalus"),  "Pteropus_macrotis")
Sister1("Pteropus_conspicillatus", "Pteropus_ocularis")
Rep_2_4("Pteropus_scapulatus", "Pteropus_woodfordi", c("Pteropus_gilliardorum", "Pteropus_mahaganus"))
SisterOrSing1(c("Pteropus_fundatus", list(c("Pteropus_rayneri", "Pteropus_cognatus"))), "Pteropus_chrysoproctus")
SisterOrSing1(c("Pteropus_rayneri", "Pteropus_cognatus"), "Pteropus_rennelli")
Sister1("Pteropus_vampyrus", "Pteropus_intermedius")
Sister1("Pteropus_livingstonii", "Pteropus_melanopogon")
Sister2("Pteropus_melanopogon", "Pteropus_aruensis", "Pteropus_keyensis")
TR<-read.tree(text="(Pteropus_mariannus:1, Pteropus_pelewensis:1, Pteropus_ualanus:1, Pteropus_yapensis:1, Pteropus_lombocensis:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Pteropus_mariannus"))
Rep_2_6("Pteropus_leucopterus", "Pteropus_vetulus", c("Pteropus_nitendiensis", "Pteropus_insularis", "Pteropus_pselaphon", "Pteropus_tuberculatus"))
Start<-c("Pteropus_alecto", "Pteropus_dasymallus", "Pteropus_hypomelanus", "Pteropus_neohibernicus", "Pteropus_ornatus", "Pteropus_pumilus", "Pteropus_speciosus", list(c("Pteropus_lombocensis", "Pteropus_molossinus", "Pteropus_rodricensis")),
list(c("Pteropus_pohlei",  "Pteropus_poliocephalus",  "Pteropus_macrotis")), list(c("Pteropus_anetianus", "Pteropus_samoensis")), list(c("Pteropus_conspicillatus", "Pteropus_ocularis")), list(c("Pteropus_personatus", "Pteropus_temminckii", "Pteropus_capistratus")),
list(c("Pteropus_aldabrensis", "Pteropus_seychellensis", "Pteropus_niger", "Pteropus_rufus", "Pteropus_voeltzkowi")), list(c("Pteropus_scapulatus", "Pteropus_woodfordi", "Pteropus_gilliardorum", "Pteropus_mahaganus")), list(c("Pteropus_fundatus", "Pteropus_rayneri", "Pteropus_cognatus", "Pteropus_chrysoproctus" , "Pteropus_rennelli")),
list(c("Pteropus_giganteus", "Pteropus_lylei", "Pteropus_vampyrus", "Pteropus_intermedius")), list(c("Pteropus_livingstonii", "Pteropus_melanopogon", "Pteropus_aruensis", "Pteropus_keyensis")), list(c("Pteropus_mariannus", "Pteropus_pelewensis", "Pteropus_ualanus", "Pteropus_yapensis", "Pteropus_lombocensis", "Pteropus_tonganus")) ,
list(c("Pteropus_leucopterus", "Pteropus_vetulus", "Pteropus_nitendiensis", "Pteropus_insularis", "Pteropus_pselaphon", "Pteropus_tuberculatus")))
MIS<-c("Pteropus_howensis", "Pteropus_melanotus", "Pteropus_griseus", "Pteropus_admiralitatum", "Pteropus_faunulus", "Pteropus_caniceps")
MIS1<-MIS[sample.int(6, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place species of Pteropus not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Pteropus_alecto", "Pteropus_dasymallus", "Pteropus_hypomelanus", "Pteropus_neohibernicus", "Pteropus_ornatus", "Pteropus_pumilus", "Pteropus_speciosus", "Pteropus_lombocensis", "Pteropus_molossinus", "Pteropus_rodricensis","Pteropus_pohlei",  "Pteropus_poliocephalus",  "Pteropus_macrotis",  "Pteropus_anetianus", "Pteropus_samoensis", "Pteropus_conspicillatus", "Pteropus_ocularis", "Pteropus_personatus", "Pteropus_temminckii", "Pteropus_capistratus", "Pteropus_aldabrensis", "Pteropus_seychellensis", "Pteropus_niger", "Pteropus_rufus", "Pteropus_voeltzkowi", "Pteropus_scapulatus", "Pteropus_woodfordi", "Pteropus_gilliardorum", "Pteropus_mahaganus",  
"Pteropus_fundatus", "Pteropus_rayneri", "Pteropus_cognatus", "Pteropus_chrysoproctus" , "Pteropus_rennelli", "Pteropus_giganteus", "Pteropus_lylei", "Pteropus_vampyrus", "Pteropus_intermedius", "Pteropus_livingstonii", "Pteropus_melanopogon", "Pteropus_aruensis", "Pteropus_keyensis", "Pteropus_mariannus", "Pteropus_pelewensis", "Pteropus_ualanus", "Pteropus_yapensis", "Pteropus_tonganus", "Pteropus_leucopterus", "Pteropus_vetulus", "Pteropus_nitendiensis", "Pteropus_insularis", "Pteropus_pselaphon", "Pteropus_tuberculatus", "Pteropus_howensis", "Pteropus_melanotus", "Pteropus_griseus", "Pteropus_admiralitatum", "Pteropus_faunulus", "Pteropus_caniceps")
MIS<-c("Pteropus_allenorum", "Pteropus_argentatus", "Pteropus_brunneus", "Pteropus_coxi", "Pteropus_pilosus", "Pteropus_subniger", "Pteropus_tokudae", "Pteropus_loochoensis")
MIS1<-MIS[sample.int(8, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(7, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(6, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Delete temporary taxon B
PHYLO<<-drop.tip(PHYLO, "B")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 16.39 MYA following Meredith et al (2011)
BD.gen(16.39,0.355)
PHYLO->Pteropodidae

################################################################################################################################################################
##############################################################Rhinolophidae#####################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Rhinolophidae<-read.tree(text="(((Rhinolophus_hipposideros:1,((Rhinolophus_pearsonii:1,(((Rhinolophus_sinicus:1,Rhinolophus_thomasi:1):1,((Rhinolophus_acuminatus:1,Rhinolophus_malayanus:1):1,((Rhinolophus_borneensis:1,Rhinolophus_megaphyllus:1):1,((Rhinolophus_pusillus:1,Rhinolophus_lepidus:1):1,((Rhinolophus_macrotis:1,Rhinolophus_rex:1):1,Rhinolophus_marshalli:1):1):1):1):1):1,(((Rhinolophus_stheno:1,Rhinolophus_shameli:1):1,(Rhinolophus_subrufus:1,Rhinolophus_arcuatus:1):1):1,Rhinolophus_affinis:1):1):1):1,Rhinolophus_formosae:1):1):1,((Rhinolophus_alcyone:1,Rhinolophus_landeri:1):1,(((Rhinolophus_mehelyi:1,Rhinolophus_euryale:1):1,Rhinolophus_blasii:1):1,(((Rhinolophus_simulator:1,Rhinolophus_denti:1):1,(Rhinolophus_capensis:1,Rhinolophus_swinnyi:1):1):1,((((Rhinolophus_fumigatus:1,Rhinolophus_eloquens:1):1,(Rhinolophus_maclaudi:1,Rhinolophus_ruwenzorii:1):1):1,(Rhinolophus_darlingi:1,Rhinolophus_hildebrandti:1):1):1,(Rhinolophus_ferrumequinum:1,Rhinolophus_clivosus:1):1):1):1):1):1):1,Rhinolophus_rufus:1);")
PHYLO<-Rhinolophidae

#Temporarily add a taxon named B to handle placements near the root of the family tree
TR<-read.tree(text="(A:1, B:1):1;")
PHYLO<<-bind.tree(TR , PHYLO,  1)
#Place most missing species of Rhinolophus based on Nature 446, 507-512 (2007)
Sister1( "Rhinolophus_macrotis", "Rhinolophus_siamensis")
Sister1( "Rhinolophus_borneensis", "Rhinolophus_nereis")
Sister1( "Rhinolophus_sinicus", "Rhinolophus_rouxii")
Sister1( "Rhinolophus_landeri", "Rhinolophus_guineensis")
SisterOrSing1( c("Rhinolophus_maclaudi", "Rhinolophus_ruwenzorii"), "Rhinolophus_hilli")
Sister2( "Rhinolophus_formosae", "Rhinolophus_beddomei", "Rhinolophus_luctus")
Sister2( "Rhinolophus_clivosus", "Rhinolophus_bocharicus",  "Rhinolophus_hillorum")
Start<-c(list(c("Rhinolophus_bocharicus", "Rhinolophus_clivosus", "Rhinolophus_hillorum")), list(c("Rhinolophus_formosae", "Rhinolophus_beddomei", "Rhinolophus_luctus")), list(c("Rhinolophus_maclaudi", "Rhinolophus_ruwenzorii", "Rhinolophus_hilli")), list(c("Rhinolophus_macrotis", "Rhinolophus_siamensis")), list(c("Rhinolophus_mehelyi", "Rhinolophus_euryale", "Rhinolophus_landeri", "Rhinolophus_guineensis")), list(c("Rhinolophus_sinicus", "Rhinolophus_rouxii")),  list(c("Rhinolophus_borneensis", "Rhinolophus_nereis")), 
"Rhinolophus_acuminatus", "Rhinolophus_affinis", "Rhinolophus_alcyone", "Rhinolophus_arcuatus", "Rhinolophus_blasii", "Rhinolophus_capensis", "Rhinolophus_darlingi", "Rhinolophus_denti", "Rhinolophus_eloquens", "Rhinolophus_ferrumequinum", "Rhinolophus_fumigatus", "Rhinolophus_hildebrandti", "Rhinolophus_hipposideros", "Rhinolophus_malayanus", "Rhinolophus_marshalli", "Rhinolophus_megaphyllus", "Rhinolophus_pearsonii", "Rhinolophus_rex", "Rhinolophus_rufus", "Rhinolophus_shameli", "Rhinolophus_simulator", "Rhinolophus_stheno", "Rhinolophus_subrufus", "Rhinolophus_swinnyi", "Rhinolophus_thomasi")
MIS<-c("Rhinolophus_philippinensis", "Rhinolophus_canuti", "Rhinolophus_celebensis", "Rhinolophus_adami", "Rhinolophus_coelophyllus", "Rhinolophus_deckenii", "Rhinolophus_euryotis", "Rhinolophus_inops", "Rhinolophus_keyensis", "Rhinolophus_mitratus", "Rhinolophus_paradoxolophus", "Rhinolophus_robinsoni", "Rhinolophus_sedulus", "Rhinolophus_silvestris", "Rhinolophus_trifoliatus", "Rhinolophus_virgo", "Rhinolophus_yunanensis")
MIS1<-MIS[sample.int(17, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(16, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(15, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(14, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(13, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(12, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(11, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(10, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(9, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(8, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(7, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(6, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
Sister1("Rhinolophus_philippinensis", "Rhinolophus_montanus")
Sister1("Rhinolophus_canuti", "Rhinolophus_creaghi")
Sister1("Rhinolophus_celebensis", "Rhinolophus_madurensis")
SisterAnd1( c("Rhinolophus_bocharicus", "Rhinolophus_clivosus", "Rhinolophus_hillorum", "Rhinolophus_formosae", "Rhinolophus_beddomei", "Rhinolophus_luctus", "Rhinolophus_maclaudi", "Rhinolophus_ruwenzorii", "Rhinolophus_hilli", "Rhinolophus_macrotis", "Rhinolophus_siamensis","Rhinolophus_mehelyi", "Rhinolophus_euryale", "Rhinolophus_landeri", "Rhinolophus_guineensis", "Rhinolophus_sinicus", "Rhinolophus_rouxii", "Rhinolophus_borneensis", "Rhinolophus_nereis",  
"Rhinolophus_acuminatus", "Rhinolophus_affinis", "Rhinolophus_alcyone", "Rhinolophus_arcuatus", "Rhinolophus_blasii", "Rhinolophus_capensis", "Rhinolophus_darlingi", "Rhinolophus_denti", "Rhinolophus_eloquens", "Rhinolophus_ferrumequinum", "Rhinolophus_fumigatus", "Rhinolophus_hildebrandti", "Rhinolophus_hipposideros", "Rhinolophus_malayanus", "Rhinolophus_marshalli", "Rhinolophus_megaphyllus", "Rhinolophus_pearsonii", "Rhinolophus_rex", "Rhinolophus_rufus", 
"Rhinolophus_shameli", "Rhinolophus_simulator", "Rhinolophus_stheno", "Rhinolophus_subrufus", "Rhinolophus_swinnyi", "Rhinolophus_thomasi", "Rhinolophus_philippinensis", "Rhinolophus_canuti", "Rhinolophus_celebensis", "Rhinolophus_adami", "Rhinolophus_coelophyllus", "Rhinolophus_deckenii", "Rhinolophus_euryotis", "Rhinolophus_inops", "Rhinolophus_keyensis", "Rhinolophus_mitratus", "Rhinolophus_paradoxolophus", "Rhinolophus_robinsoni", "Rhinolophus_sedulus",
"Rhinolophus_silvestris", "Rhinolophus_trifoliatus", "Rhinolophus_virgo", "Rhinolophus_yunanensis",  "Rhinolophus_montanus", "Rhinolophus_creaghi", "Rhinolophus_madurensis"),  "Rhinolophus_cognatus")
Sister1( "Rhinolophus_cognatus", "Rhinolophus_subbadius")
Sister1( "Rhinolophus_lepidus", "Rhinolophus_shortridgei")
#Place species of Rhinolophus not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Rhinolophus_bocharicus", "Rhinolophus_clivosus", "Rhinolophus_hillorum", "Rhinolophus_formosae", "Rhinolophus_beddomei", "Rhinolophus_luctus", "Rhinolophus_maclaudi", "Rhinolophus_ruwenzorii", "Rhinolophus_hilli", "Rhinolophus_macrotis", "Rhinolophus_siamensis","Rhinolophus_mehelyi", "Rhinolophus_euryale", "Rhinolophus_landeri", "Rhinolophus_guineensis", "Rhinolophus_sinicus", "Rhinolophus_rouxii", "Rhinolophus_borneensis", "Rhinolophus_nereis",  
"Rhinolophus_acuminatus", "Rhinolophus_affinis", "Rhinolophus_alcyone", "Rhinolophus_arcuatus", "Rhinolophus_blasii", "Rhinolophus_capensis", "Rhinolophus_darlingi", "Rhinolophus_denti", "Rhinolophus_eloquens", "Rhinolophus_ferrumequinum", "Rhinolophus_fumigatus", "Rhinolophus_hildebrandti", "Rhinolophus_hipposideros", "Rhinolophus_malayanus", "Rhinolophus_marshalli", "Rhinolophus_megaphyllus", "Rhinolophus_pearsonii", "Rhinolophus_rex", "Rhinolophus_rufus", 
"Rhinolophus_shameli", "Rhinolophus_simulator", "Rhinolophus_stheno", "Rhinolophus_subrufus", "Rhinolophus_swinnyi", "Rhinolophus_thomasi", "Rhinolophus_philippinensis", "Rhinolophus_canuti", "Rhinolophus_celebensis", "Rhinolophus_adami", "Rhinolophus_coelophyllus", "Rhinolophus_deckenii", "Rhinolophus_euryotis", "Rhinolophus_inops", "Rhinolophus_keyensis", "Rhinolophus_mitratus", "Rhinolophus_paradoxolophus", "Rhinolophus_robinsoni", "Rhinolophus_sedulus",
"Rhinolophus_silvestris", "Rhinolophus_trifoliatus", "Rhinolophus_virgo", "Rhinolophus_yunanensis",  "Rhinolophus_montanus",  "Rhinolophus_creaghi", "Rhinolophus_madurensis",  "Rhinolophus_cognatus", "Rhinolophus_subbadius",  "Rhinolophus_lepidus", "Rhinolophus_shortridgei", "Rhinolophus_pusillus")
MIS<-c( "Rhinolophus_osgoodi", "Rhinolophus_convexus", "Rhinolophus_maendeleo", "Rhinolophus_sakejiensis", "Rhinolophus_ziama")
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Delete temporary taxon B
PHYLO<<-drop.tip(PHYLO, "B")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 20 MYA following Meredith et al (2011)
BD.gen(20,0.355)
PHYLO->Rhinolophidae

################################################################################################################################################################
###########################################################Rhinopomatidae#######################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Rhinopomatidae<-read.tree(text="(Rhinopoma_hardwickii:1,(Rhinopoma_muscatellum:1,Rhinopoma_microphyllum:1):1);")
PHYLO<-Rhinopomatidae

#Place Rhinopoma_macinnesi based on Nature 446, 507-512 (2007)
Sister1("Rhinopoma_hardwickii", "Rhinopoma_macinnesi")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 29 MYA following Meredith et al (2011)
YULE.gen(29)
PHYLO->Rhinopomatidae

################################################################################################################################################################
###########################################################Thyropteridae########################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Thyropteridae<-read.tree(text="((Thyroptera_tricolor:1,Thyroptera_lavali:1):1,Thyroptera_discifera:1);")
PHYLO<-Thyropteridae

#Place Thyroptera_devivoi based on taxonomy
SisterOrSing1(c("Thyroptera_discifera", "Thyroptera_lavali", "Thyroptera_tricolor"), "Thyroptera_devivoi")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 10 MYA following Meredith et al (2011)
BD.gen(10,0.355)
PHYLO->Thyropteridae

################################################################################################################################################################
##############################################################Vespertilionidae##################################################################################
################################################################################################################################################################

#One of the trees of the family from the posterior distribution
Vespertilionidae<-read.tree(text="((Eudiscopus_denticulus:1,(Cistugo_seabrae:1,((((Scotophilus_kuhlii:1,((Scotophilus_heathii:1,(Scotophilus_leucogaster:1,((Scotophilus_dinganii:1,Scotophilus_borbonicus:1):1,Scotophilus_viridis:1):1):1):1,Scotophilus_nux:1):1):1,Rhogeessa_alleni:1):1,((Nycticeius_humeralis:1,Idionycteris_phyllotis:1):1,(((Pipistrellus_subflavus:1,Pipistrellus_hesperus:1):1,((((Arielulus_aureocollaris:1,(((Glauconycteris_egeria:1,Glauconycteris_argentata:1):1,Glauconycteris_variegata:1):1,Glauconycteris_beatrix:1):1):1,Lasionycteris_noctivagans:1):1,((Ia_io:1,Scotomanes_ornatus:1):1,((((Eptesicus_diminutus:1,(Eptesicus_brasiliensis:1,Eptesicus_furinalis:1):1):1,Eptesicus_fuscus:1):1,(Histiotus_magellanicus:1,Histiotus_macrotus:1):1):1,(Eptesicus_serotinus:1,Eptesicus_hottentotus:1):1):1):1):1,(((((Scotoecus_hirundo:1,Glischropus_tylopus:1):1,(((Pipistrellus_paterculus:1,Pipistrellus_tenuis:1):1,(Pipistrellus_coromandra:1,Pipistrellus_javanicus:1):1):1,((Pipistrellus_nathusii:1,(Nyctalus_noctula:1,Nyctalus_leisleri:1):1):1,(Pipistrellus_hesperidus:1,(Pipistrellus_pipistrellus:1,Pipistrellus_pygmaeus:1):1):1):1):1):1,Vespertilio_murinus:1):1,(((Laephotis_namibensis:1,Philetor_brachypterus:1):1,((((Pipistrellus_rendalli:1,Pipistrellus_brunneus:1):1,Pipistrellus_nanus:1):1,Pipistrellus_somalicus:1):1,((((Chalinolobus_gouldii:1,Chalinolobus_morio:1):1,(Vespadelus_vulturnus:1,Vespadelus_regulus:1):1):1,(Pipistrellus_savii:1,Pipistrellus_cadornae:1):1):1,(Nycticeinops_schlieffeni:1,Pipistrellus_eisentrauti:1):1):1):1):1,(Tylonycteris_robustula:1,Tylonycteris_pachypus:1):1):1):1,(Hesperoptenus_blanfordi:1,Hesperoptenus_tickelli:1):1):1):1):1,((((Otonycteris_hemprichii:1,(Corynorhinus_rafinesquii:1,(Corynorhinus_mexicanus:1,Corynorhinus_townsendii:1):1):1):1,(Plecotus_auritus:1,Plecotus_austriacus:1):1):1,((((Rhogeessa_aeneus:1,Rhogeessa_tumida:1):1,(Rhogeessa_parvula:1,Rhogeessa_mira:1):1):1,Antrozous_pallidus:1):1,Barbastella_barbastellus:1):1):1,(((Lasiurus_intermedius:1,(Lasiurus_xanthinus:1,Lasiurus_ega:1):1):1,(Lasiurus_cinereus:1,(Lasiurus_atratus:1,((Lasiurus_blossevillii:1,Lasiurus_borealis:1):1,Lasiurus_seminolus:1):1):1):1):1,Euderma_maculatum:1):1):1):1):1):1,(((((((Myotis_dominicensis:1,Myotis_albescens:1):1,(Myotis_levis:1,Myotis_nigricans:1):1):1,(Myotis_velifer:1,Myotis_yumanensis:1):1):1,(Myotis_keaysi:1,Myotis_riparius:1):1):1,(((Myotis_septentrionalis:1,((Myotis_ciliolabrum:1,Myotis_californicus:1):1,Myotis_thysanodes:1):1):1,Myotis_fortidens:1):1,Myotis_volans:1):1):1,((Myotis_myotis:1,(Myotis_bocagii:1,Myotis_welwitschii:1):1):1,(Myotis_capaccinii:1,Myotis_moluccarum:1):1):1):1,((Harpiola_isodon:1,(Harpiocephalus_harpia:1,(Murina_huttoni:1,Murina_cyclotis:1):1):1):1,((Kerivoula_lenis:1,Kerivoula_hardwickii:1):1,Kerivoula_pellucida:1):1):1):1):1):1):1,(Miniopterus_schreibersii:1,(Miniopterus_tristis:1,(Miniopterus_fraterculus:1,Miniopterus_inflatus:1):1):1):1);")
PHYLO<-Vespertilionidae
#One of the trees for the genus Eptesicus from the posterior distribution
Eptesicus<-read.tree(text="(Eptesicus_nasutus:1,((Eptesicus_nilssonii:1,((Eptesicus_serotinus:1,Eptesicus_bottae:1):1,Eptesicus_gobiensis:1):1):1,(Eptesicus_hottentotus:1,((Eptesicus_fuscus:1,Eptesicus_furinalis:1):1,(Eptesicus_chiriquinus:1,(Eptesicus_brasiliensis:1,Eptesicus_diminutus:1):1):1):1):1):1);")
MONOP.GROUP<-c("Eptesicus_brasiliensis", "Eptesicus_diminutus", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus", "Eptesicus_bottae", "Eptesicus_chiriquinus", "Eptesicus_dimissus", "Eptesicus_gobiensis", "Eptesicus_nasutus", "Eptesicus_nilssonii")
#Merging the family tree with the tree for Eptesicus
Replace.groups(Eptesicus, MONOP.GROUP)
#One of the trees for the genus Laephotis from the posterior distribution
Laephotis<-read.tree(text="(Laephotis_namibensis:1,(Laephotis_botswanae:1,Laephotis_wintoni:1):1);")
MONOP.GROUP<-c("Laephotis_botswanae", "Laephotis_namibensis", "Laephotis_wintoni")
#Merging the family tree with the tree for Laephotis
Replace.groups(Laephotis, MONOP.GROUP)
#One of the trees for the genus Miniopterus from the posterior distribution
Miniopterus<-read.tree(text="(Miniopterus_oceanensis:1,((Miniopterus_macrocneme:1,(((((((Miniopterus_petersoni:1,Miniopterus_manavi:1):1,(Miniopterus_majori:1,Miniopterus_gleni:1):1):1,Miniopterus_griveaudi:1):1,((Miniopterus_inflatus:1,(Miniopterus_fraterculus:1,Miniopterus_minor:1):1):1,Miniopterus_newtoni:1):1):1,Miniopterus_sororculus:1):1,Miniopterus_natalensis:1):1,Miniopterus_paululus:1):1):1,(Miniopterus_magnater:1,(Miniopterus_fuliginosus:1,Miniopterus_schreibersii:1):1):1):1);")
MONOP.GROUP<-c("Miniopterus_fraterculus", "Miniopterus_inflatus", "Miniopterus_schreibersii", "Miniopterus_tristis", "Miniopterus_fuliginosus", "Miniopterus_gleni", "Miniopterus_griveaudi", "Miniopterus_macrocneme", "Miniopterus_magnater", "Miniopterus_majori", "Miniopterus_manavi", "Miniopterus_minor", "Miniopterus_natalensis", "Miniopterus_newtoni", "Miniopterus_oceanensis", "Miniopterus_paululus", "Miniopterus_petersoni", "Miniopterus_sororculus")
#Merging the family tree with the tree for Miniopterus
Replace.groups(Miniopterus, MONOP.GROUP)
#One of the trees for the genus Murinafrom the posterior distribution
Murina<-read.tree(text="(((Murina_hilgendorfi:1,(Murina_leucogaster:1,Murina_aurata:1):1):1,(Murina_cyclotis:1,((Murina_aenea:1,(Murina_rozendaali:1,Murina_tubinaris:1):1):1,(Murina_florium:1,Murina_suilla:1):1):1):1):1,(Murina_puta:1,Murina_huttoni:1):1);")
MONOP.GROUP<-c("Murina_cyclotis", "Murina_huttoni", "Murina_aenea", "Murina_aurata", "Murina_florium", "Murina_hilgendorfi", "Murina_leucogaster", "Murina_puta", "Murina_rozendaali", "Murina_suilla", "Murina_tubinaris")
#Merging the family tree with the tree for Murina
Replace.groups(Murina, MONOP.GROUP)
#One of the trees for the genus Myotis from the posterior distribution
Myotis<-read.tree(text="(Myotis_moluccarum:1,((((((Myotis_anjouanensis:1,Myotis_goudoti:1):1,(Myotis_scotti:1,((Myotis_bocagii:1,Myotis_welwitschii:1):1,Myotis_formosus:1):1):1):1,(Myotis_tricolor:1,Myotis_emarginatus:1):1):1,(Myotis_dasycneme:1,(((Myotis_muricola:1,((Myotis_annectans:1,Myotis_gomantongensis:1):1,(Myotis_pruinosus:1,(Myotis_montivagus:1,Myotis_yanbarensis:1):1):1):1):1,((((Myotis_daubentonii:1,Myotis_bechsteinii:1):1,Myotis_frater:1):1,Myotis_sicarius:1):1,((((Myotis_myotis:1,Myotis_blythii:1):1,Myotis_punicus:1):1,((Myotis_schaubi:1,(Myotis_pequinius:1,(Myotis_nattereri:1,Myotis_bombinus:1):1):1):1,Myotis_chinensis:1):1):1,(((((Myotis_ridleyi:1,(Myotis_macrodactylus:1,Myotis_macrotarsus:1):1):1,(Myotis_horsfieldii:1,(Myotis_hasseltii:1,Myotis_macropus:1):1):1):1,Myotis_rosseti:1):1,Myotis_capaccinii:1):1,(((Myotis_davidii:1,Myotis_siligorensis:1):1,(Myotis_annamiticus:1,(Myotis_laniger:1,Myotis_longipes:1):1):1):1,(Myotis_adversus:1,Myotis_fimbriatus:1):1):1):1):1):1):1,(Myotis_mystacinus:1,(Myotis_nipalensis:1,(Myotis_ikonnikovi:1,Myotis_altarium:1):1):1):1):1):1):1,(Myotis_hajastanicus:1,(((((((Myotis_grisescens:1,Myotis_austroriparius:1):1,((Myotis_velifer:1,Myotis_yumanensis:1):1,(((Myotis_oxyotus:1,(Myotis_nigricans:1,Myotis_levis:1):1):1,Myotis_albescens:1):1,Myotis_chiloensis:1):1):1):1,((Myotis_atacamensis:1,Myotis_dominicensis:1):1,Myotis_martiniquensis:1):1):1,(Myotis_vivesi:1,Myotis_fortidens:1):1):1,((Myotis_ruber:1,(Myotis_riparius:1,(Myotis_elegans:1,Myotis_simus:1):1):1):1,Myotis_keaysi:1):1):1,Myotis_brandtii:1):1,(((Myotis_californicus:1,Myotis_leibii:1):1,Myotis_ciliolabrum:1):1,(((Myotis_keenii:1,(Myotis_lucifugus:1,(Myotis_thysanodes:1,Myotis_evotis:1):1):1):1,(Myotis_sodalis:1,Myotis_volans:1):1):1,(Myotis_auriculus:1,Myotis_septentrionalis:1):1):1):1):1):1):1,Myotis_alcathoe:1):1);")
MONOP.GROUP<-c("Myotis_albescens", "Myotis_bocagii", "Myotis_californicus", "Myotis_capaccinii", "Myotis_ciliolabrum", "Myotis_dominicensis", "Myotis_fortidens", "Myotis_keaysi", "Myotis_levis", "Myotis_moluccarum", "Myotis_myotis", "Myotis_nigricans", "Myotis_riparius", "Myotis_septentrionalis", "Myotis_thysanodes", "Myotis_velifer", "Myotis_volans", "Myotis_welwitschii", "Myotis_yumanensis", "Myotis_adversus", "Myotis_alcathoe", "Myotis_altarium", "Myotis_anjouanensis", "Myotis_annamiticus", "Myotis_annectans", "Myotis_atacamensis", "Myotis_auriculus", "Myotis_austroriparius", "Myotis_bechsteinii", "Myotis_blythii", "Myotis_bombinus", "Myotis_brandtii", "Myotis_chiloensis", "Myotis_chinensis", "Myotis_dasycneme", "Myotis_daubentonii", "Myotis_davidii", "Myotis_elegans", "Myotis_emarginatus", "Myotis_evotis", "Myotis_fimbriatus", "Myotis_formosus", "Myotis_
frater", "Myotis_gomantongensis", "Myotis_goudoti", "Myotis_grisescens", "Myotis_hajastanicus", "Myotis_hasseltii", "Myotis_horsfieldii", "Myotis_ikonniii", "Myotis_laniger", "Myotis_leibii", "Myotis_longipes", "Myotis_lucifugus", "Myotis_macrodactylus", "Myotis_macropus", "Myotis_macrotarsus", "Myotis_martiniquensis", "Myotis_montivagus", "Myotis_muricola", "Myotis_mystacinus", "Myotis_nattereri", "Myotis_nipalensis", "Myotis_oxyotus", "Myotis_pequinius", "Myotis_pruinosus", "Myotis_punicus", "Myotis_ridleyi", "Myotis_rosseti", "Myotis_ruber", "Myotis_schaubi", "Myotis_scotti", "Myotis_sicarius", "Myotis_siligorensis", "Myotis_simus", "Myotis_sodalis", "Myotis_tricolor", "Myotis_vivesi", "Myotis_yanbarensis")
#Merging the family tree with the tree for Myotis
Replace.groups(Myotis, MONOP.GROUP)
#One of the trees for the genus Nyctalus from the posterior distribution
Nyctalus<-read.tree(text="(Nyctalus_plancyi:1,((Nyctalus_aviator:1,(Nyctalus_noctula:1,Nyctalus_lasiopterus:1):1):1,(Nyctalus_leisleri:1,Nyctalus_azoreum:1):1):1);")
MONOP.GROUP<-c("Nyctalus_leisleri", "Nyctalus_noctula", "Nyctalus_aviator", "Nyctalus_azoreum", "Nyctalus_lasiopterus", "Nyctalus_plancyi")
#Merging the family tree with the tree for Nyctalus
Replace.groups(Nyctalus, MONOP.GROUP)
#One of the trees for the genus Plecotus from the posterior distribution
Plecotus<-read.tree(text="(((Plecotus_macrobullaris:1,Plecotus_sardus:1):1,(Plecotus_ognevi:1,Plecotus_sacrimontis:1):1):1,(((Plecotus_teneriffae:1,Plecotus_kolombatovici:1):1,Plecotus_austriacus:1):1,(Plecotus_christii:1,Plecotus_balensis:1):1):1);")
MONOP.GROUP<-c("Plecotus_auritus", "Plecotus_austriacus", "Plecotus_balensis", "Plecotus_christii", "Plecotus_kolombatovici", "Plecotus_macrobullaris", "Plecotus_ognevi", "Plecotus_sacrimontis", "Plecotus_sardus", "Plecotus_teneriffae")
#Merging the family tree with the tree for Plecotus
Replace.groups(Plecotus, MONOP.GROUP)
#One of the trees for the genus Rhogeessa from the posterior distribution
Rhogeessa<-read.tree(text="(Rhogeessa_gracilis:1,(Rhogeessa_alleni:1,(((Rhogeessa_genowaysi:1,Rhogeessa_tumida:1):1,Rhogeessa_io:1):1,(Rhogeessa_mira:1,Rhogeessa_parvula:1):1):1):1);")
MONOP.GROUP<-c("Rhogeessa_aeneus", "Rhogeessa_alleni", "Rhogeessa_mira", "Rhogeessa_parvula", "Rhogeessa_tumida", "Rhogeessa_genowaysi", "Rhogeessa_gracilis", "Rhogeessa_io")
#Merging the family tree with the tree for Rhogeessa
Replace.groups(Rhogeessa, MONOP.GROUP)
#One of the trees for the genus Scotophilus from the posterior distribution
Scotophilus<-read.tree(text="(Scotophilus_kuhlii:1,(((Scotophilus_leucogaster:1,(Scotophilus_heathii:1,(((Scotophilus_dinganii:1,Scotophilus_viridis:1):1,Scotophilus_nigrita:1):1,Scotophilus_robustus:1):1):1):1,Scotophilus_marovaza:1):1,Scotophilus_nux:1):1);")
MONOP.GROUP<-c("Scotophilus_borbonicus", "Scotophilus_dinganii", "Scotophilus_heathii", "Scotophilus_kuhlii", "Scotophilus_leucogaster", "Scotophilus_nigrita", "Scotophilus_nux", "Scotophilus_viridis", "Scotophilus_marovaza", "Scotophilus_robustus")
#Merging the family tree with the tree for Scotophilus
Replace.groups(Scotophilus, MONOP.GROUP)

#Place Bauerus as sister to Antrozous based on Nature 446, 507-512 (2007)
Sister1("Antrozous_pallidus", "Bauerus_dubiaquercus")
#Place missing species of Nyctalus based on Nature 446, 507-512 (2007)
SisterOrSing1(c("Nyctalus_noctula", "Nyctalus_plancyi"), "Nyctalus_furvus")
SisterOrSing1(c("Nyctalus_azoreum", "Nyctalus_aviator", "Nyctalus_lasiopterus", "Nyctalus_leisleri",  list(c("Nyctalus_noctula", "Nyctalus_plancyi", "Nyctalus_furvus"))), "Nyctalus_montanus")
#Place Scotorepens as sister to Nycticeinops based on Nature 446, 507-512 (2007)
TR<-read.tree(text="(Nycticeinops_schlieffeni:1, ((Scotorepens_balstoni:1, Scotorepens_orion:1):1,(Scotorepens_greyii:1,Scotorepens_sanborni:1):1):1);")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Nycticeinops_schlieffeni"))
#Place missing species of Kerivoula based on taxonomy and on the questionable species status of Kerivoula_papillosa
Rep_3_21ODD("Kerivoula_hardwickii", "Kerivoula_lenis", "Kerivoula_pellucida", c("Kerivoula_africana", "Kerivoula_agnella", "Kerivoula_argentata", "Kerivoula_cuprosa", "Kerivoula_eriophora", "Kerivoula_flora", "Kerivoula_intermedia", "Kerivoula_kachinensis", "Kerivoula_krauensis", "Kerivoula_lanosa", "Kerivoula_minuta", "Kerivoula_muscina", "Kerivoula_myrella", "Kerivoula_phalaena", "Kerivoula_picta", "Kerivoula_smithii", "Kerivoula_titania", "Kerivoula_whiteheadi"))
Sister1("Kerivoula_lenis", "Kerivoula_papillosa")
#Place missing species of Vespadelus based on taxonomy
Rep_2_9("Vespadelus_regulus", "Vespadelus_vulturnus", c("Vespadelus_baverstocki", "Vespadelus_caurinus", "Vespadelus_darlingtoni", "Vespadelus_douglasorum", "Vespadelus_finlaysoni", "Vespadelus_pumilus", "Vespadelus_troughtoni"))
#Place missing species of Arielulus based on taxonomy
TR<-read.tree(text="(Arielulus_aureocollaris:1, Arielulus_circumdatus:1, Arielulus_cuprosus:1, Arielulus_societatis:1, Arielulus_torquatus:1 ):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Arielulus_aureocollaris"))
#Place missing species of Scotoecus based on Nature 446, 507-512 (2007)
TR<-read.tree(text="(Scotoecus_pallidus:1,(Scotoecus_hirundo:1,Scotoecus_albofuscus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Scotoecus_hirundo"))
#Place Phoniscus as sister to Kerivoula based on Nature 446, 507-512 (2007)
SisterAnd1(c("Kerivoula_africana", "Kerivoula_agnella", "Kerivoula_argentata", "Kerivoula_cuprosa", "Kerivoula_eriophora", "Kerivoula_flora", "Kerivoula_intermedia", "Kerivoula_kachinensis", "Kerivoula_krauensis", "Kerivoula_lanosa", "Kerivoula_minuta", "Kerivoula_muscina", "Kerivoula_myrella", "Kerivoula_phalaena", "Kerivoula_picta", "Kerivoula_smithii", "Kerivoula_titania", "Kerivoula_whiteheadi", "Kerivoula_hardwickii", "Kerivoula_lenis", "Kerivoula_pellucida", "Kerivoula_papillosa"), "Phoniscus_jagorii")
Sister2("Phoniscus_jagorii", "Phoniscus_atrox", "Phoniscus_papuensis")
#Place Nycticeius_cubanus based on taxonomy
Sister1("Nycticeius_humeralis", "Nycticeius_cubanus")
#Place Glischropus_javanus based on taxonomy
Sister1("Glischropus_tylopus", "Glischropus_javanus")
#Place missing species of Hesperoptenus based on taxonomy
Rep_2_5("Hesperoptenus_blanfordi", "Hesperoptenus_tickelli", c("Hesperoptenus_doriae", "Hesperoptenus_gaskelli", "Hesperoptenus_tomesi"))
#Place  missing species of Histiotus based on Nature 446, 507-512 (2007)
Rep_2_5("Histiotus_magellanicus", "Histiotus_macrotus", c("Histiotus_alienus", "Histiotus_humboldti", "Histiotus_velatus"))
Sister1("Histiotus_macrotus", "Histiotus_laephotis")
Sister1("Histiotus_magellanicus", "Histiotus_montanus")
#Place  missing species of Chalinolobus based on Nature 446, 507-512 (2007)
Rep_2_5("Chalinolobus_gouldii", "Chalinolobus_morio", c("Chalinolobus_dwyeri", "Chalinolobus_nigrogriseus", "Chalinolobus_picatus"))
Sister1("Chalinolobus_gouldii", "Chalinolobus_neocaledonicus")
SisterAnd1(c( "Chalinolobus_gouldii", "Chalinolobus_morio", "Chalinolobus_dwyeri", "Chalinolobus_nigrogriseus", "Chalinolobus_picatus", "Chalinolobus_neocaledonicus"), "Chalinolobus_tuberculatus")
#Place most missing species of Pipistrellus based on Nature 446, 507-512 (2007)
Sister1("Pipistrellus_eisentrauti", "Pipistrellus_anchietae")
Sister1("Pipistrellus_hesperus", "Pipistrellus_musciculus")
TR<-read.tree(text="(Pipistrellus_imbricatus:1,(Pipistrellus_arabicus:1,(Pipistrellus_helios:1,Pipistrellus_nanus:1):1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_nanus"))
TR<-read.tree(text="(Pipistrellus_cadornae:1, (Pipistrellus_macrotis:1, Pipistrellus_vordermanni:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_cadornae"))
TR<-read.tree(text="(Pipistrellus_ariel:1, (Pipistrellus_alaschanicus:1, Pipistrellus_savii:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_savii"))
Sister2("Pipistrellus_rendalli", "Pipistrellus_flavescens", "Pipistrellus_tenuipinnis")
Rep_2_5("Pipistrellus_brunneus", "Pipistrellus_somalicus", c("Pipistrellus_capensis", "Pipistrellus_guineensis", "Pipistrellus_melckorum"))
Sister1("Pipistrellus_somalicus", "Pipistrellus_zuluensis")
TR<-read.tree(text="(Pipistrellus_deserti:1, Pipistrellus_aero:1, Pipistrellus_inexspectatus:1, Pipistrellus_maderensis:1, Pipistrellus_rusticus:1, (Pipistrellus_kuhlii:1,Pipistrellus_hesperidus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_hesperidus"))
SisterOrSing1(c("Pipistrellus_nathusii", list(c("Pipistrellus_pipistrellus", "Pipistrellus_pygmaeus"))), "Pipistrellus_permixtus")
TR<-read.tree(text="(Pipistrellus_tenuis:1,Pipistrellus_adamsi:1,Pipistrellus_angulatus:1,Pipistrellus_collinus:1,Pipistrellus_papuanus:1,Pipistrellus_wattsi:1,Pipistrellus_westralis:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_tenuis"))
SisterOrSing1(c("Pipistrellus_javanicus", "Pipistrellus_paterculus"), "Pipistrellus_endoi")
Sister1("Pipistrellus_javanicus", "Pipistrellus_abramus")
SisterOrSing1(list(c(c("Pipistrellus_deserti", "Pipistrellus_aero", "Pipistrellus_inexspectatus", "Pipistrellus_maderensis", "Pipistrellus_rusticus", "Pipistrellus_kuhlii", "Pipistrellus_hesperidus")), list(c("Pipistrellus_nathusii", "Pipistrellus_pipistrellus", "Pipistrellus_pygmaeus", "Pipistrellus_permixtus")),
list(c("Pipistrellus_javanicus", "Pipistrellus_paterculus", "Pipistrellus_endoi",  "Pipistrellus_abramus")), list(c("Pipistrellus_coromandra", "Pipistrellus_tenuis", "Pipistrellus_adamsi", "Pipistrellus_angulatus", "Pipistrellus_collinus", "Pipistrellus_papuanus", "Pipistrellus_wattsi", "Pipistrellus_westralis"))), "Pipistrellus_minahassae")
Sister1("Pipistrellus_minahassae", "Pipistrellus_ceylonicus")
Start<-c("Pipistrellus_subflavus", list(c("Pipistrellus_eisentrauti", "Pipistrellus_anchietae")), list(c("Pipistrellus_hesperus", "Pipistrellus_musciculus")), list(c("Pipistrellus_imbricatus", "Pipistrellus_arabicus", "Pipistrellus_helios", "Pipistrellus_nanus")),
list(c("Pipistrellus_cadornae", "Pipistrellus_macrotis", "Pipistrellus_vordermanni", "Pipistrellus_ariel", "Pipistrellus_alaschanicus", "Pipistrellus_savii")), list(c("Pipistrellus_kuhlii", "Pipistrellus_hesperidus")), 
list(c("Pipistrellus_rendalli", "Pipistrellus_flavescens", "Pipistrellus_tenuipinnis", "Pipistrellus_brunneus", "Pipistrellus_somalicus", "Pipistrellus_capensis", "Pipistrellus_guineensis", "Pipistrellus_melckorum", "Pipistrellus_zuluensis")), 
list(c("Pipistrellus_deserti", "Pipistrellus_aero", "Pipistrellus_inexspectatus", "Pipistrellus_maderensis", "Pipistrellus_rusticus", "Pipistrellus_kuhlii", "Pipistrellus_hesperidus", "Pipistrellus_nathusii", "Pipistrellus_pipistrellus", "Pipistrellus_pygmaeus", "Pipistrellus_permixtus", "Pipistrellus_javanicus", "Pipistrellus_paterculus", "Pipistrellus_endoi",  "Pipistrellus_abramus",
"Pipistrellus_coromandra", "Pipistrellus_tenuis", "Pipistrellus_adamsi", "Pipistrellus_angulatus", "Pipistrellus_collinus", "Pipistrellus_papuanus", "Pipistrellus_wattsi", "Pipistrellus_westralis", "Pipistrellus_minahassae",  "Pipistrellus_ceylonicus")))
MIS<- c("Pipistrellus_anthonyi", "Pipistrellus_crassulus", "Pipistrellus_pulveratus")
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
Sister2("Pipistrellus_anthonyi", "Pipistrellus_joffrei", "Pipistrellus_stenopterus")
Sister2("Pipistrellus_crassulus", "Pipistrellus_nanulus", "Pipistrellus_rueppellii")
TR<-read.tree(text="(Pipistrellus_pulveratus:1,(Pipistrellus_kitcheneri:1, Pipistrellus_lophurus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Pipistrellus_pulveratus"))
#Place species of Pipistrellus not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Pipistrellus_subflavus",  "Pipistrellus_eisentrauti", "Pipistrellus_anchietae",  "Pipistrellus_hesperus", "Pipistrellus_musciculus", "Pipistrellus_imbricatus", "Pipistrellus_arabicus", "Pipistrellus_helios", "Pipistrellus_nanus", "Pipistrellus_cadornae", "Pipistrellus_macrotis", "Pipistrellus_vordermanni", "Pipistrellus_ariel", "Pipistrellus_alaschanicus", "Pipistrellus_savii", "Pipistrellus_kuhlii", "Pipistrellus_hesperidus", "Pipistrellus_rendalli", "Pipistrellus_flavescens", "Pipistrellus_tenuipinnis", "Pipistrellus_brunneus", "Pipistrellus_somalicus", "Pipistrellus_capensis", "Pipistrellus_guineensis", "Pipistrellus_melckorum", "Pipistrellus_zuluensis", "Pipistrellus_deserti", "Pipistrellus_aero", "Pipistrellus_inexspectatus", "Pipistrellus_maderensis", "Pipistrellus_rusticus",  "Pipistrellus_nathusii", "Pipistrellus_pipistrellus", "Pipistrellus_pygmaeus", "Pipistrellus_permixtus",  "Pipistrellus_javanicus", 
"Pipistrellus_paterculus",  "Pipistrellus_endoi",  "Pipistrellus_abramus", "Pipistrellus_coromandra", "Pipistrellus_tenuis", "Pipistrellus_adamsi", "Pipistrellus_angulatus", "Pipistrellus_collinus", "Pipistrellus_papuanus", "Pipistrellus_wattsi", "Pipistrellus_westralis", "Pipistrellus_minahassae",  "Pipistrellus_ceylonicus", "Pipistrellus_anthonyi", "Pipistrellus_joffrei", "Pipistrellus_stenopterus", "Pipistrellus_crassulus", "Pipistrellus_nanulus", "Pipistrellus_rueppellii", "Pipistrellus_pulveratus", "Pipistrellus_kitcheneri", "Pipistrellus_lophurus")
MIS<- c("Pipistrellus_hanaki", "Pipistrellus_murrayi", "Pipistrellus_raceyi")
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Harpiocephalus_mordax based on taxonomy
Sister1("Harpiocephalus_harpia", "Harpiocephalus_mordax")
#Place most missing species of Lasiurus based on Nature 446, 507-512 (2007)
Sister1("Lasiurus_intermedius", "Lasiurus_insularis")
Rep_3_7("Lasiurus_atratus",  "Lasiurus_borealis", "Lasiurus_blossevillii", c("Lasiurus_minor", "Lasiurus_pfeifferi", "Lasiurus_varius", "Lasiurus_degelidus"))
SisterOrSing1(list(c(c("Lasiurus_atratus", "Lasiurus_borealis", "Lasiurus_blossevillii", "Lasiurus_minor", "Lasiurus_pfeifferi",  "Lasiurus_varius", "Lasiurus_degelidus", "Lasiurus_seminolus")), "Lasiurus_cinereus"), "Lasiurus_castaneus")
SisterOrSing1( c(list(c("Lasiurus_atratus","Lasiurus_borealis", "Lasiurus_blossevillii", "Lasiurus_minor", "Lasiurus_pfeifferi", "Lasiurus_varius", "Lasiurus_degelidus", "Lasiurus_seminolus", "Lasiurus_cinereus", "Lasiurus_castaneus")), list(c("Lasiurus_ega", "Lasiurus_xanthinus", "Lasiurus_intermedius", "Lasiurus_insularis"))),  "Lasiurus_egregius")
#Place Lasiurus_ebenus based on taxonomy
SisterOrSing1(c("Lasiurus_atratus","Lasiurus_borealis", "Lasiurus_blossevillii", "Lasiurus_minor", "Lasiurus_pfeifferi",  "Lasiurus_varius", "Lasiurus_degelidus", "Lasiurus_seminolus", "Lasiurus_cinereus", "Lasiurus_castaneus", "Lasiurus_ega", "Lasiurus_xanthinus", "Lasiurus_intermedius", "Lasiurus_insularis",  "Lasiurus_egregius"), "Lasiurus_ebenus")
#Place missing species of Glauconycteris based on Nature 446, 507-512 (2007)
Rep_4_10("Glauconycteris_argentata", "Glauconycteris_beatrix", "Glauconycteris_egeria", "Glauconycteris_variegata", c("Glauconycteris_alboguttata", "Glauconycteris_curryae", "Glauconycteris_gleni", "Glauconycteris_kenyacola", "Glauconycteris_poensis", "Glauconycteris_superba"))
Sister1("Glauconycteris_beatrix", "Glauconycteris_humeralis")
Sister1("Glauconycteris_variegata", "Glauconycteris_machadoi")
Sister1("Barbastella_barbastellus", "Barbastella_leucomelas")
#Place Cistugo_lesueuri based on taxonomy
Sister1("Cistugo_seabrae", "Cistugo_lesueuri")
#Place Harpiola_grisea based on taxonomy
Sister1("Harpiola_isodon",  "Harpiola_grisea")
#Place most missing species of Eptesicus based on Nature 446, 507-512 (2007)
Sister1("Eptesicus_diminutus", "Eptesicus_innoxius")
SisterOrSing1( c("Eptesicus_chiriquinus", "Eptesicus_brasiliensis"), "Eptesicus_andinus")
SisterOrSing1( c("Eptesicus_gobiensis", "Eptesicus_nilssonii"),  "Eptesicus_japonensis")
SisterAnd1( c("Eptesicus_gobiensis", "Eptesicus_nilssonii", "Eptesicus_japonensis"), "Eptesicus_bobrinskoi")
Start<-c(list(c("Eptesicus_diminutus", "Eptesicus_innoxius")),  list(c("Eptesicus_chiriquinus", "Eptesicus_brasiliensis", "Eptesicus_andinus")), "Eptesicus_bottae", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus")
MIS<-c("Eptesicus_dimissus", "Eptesicus_guadeloupensis", "Eptesicus_pachyotis", "Eptesicus_platyops",  "Eptesicus_tatei")
MIS1<-MIS[sample.int(5, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
SisterAnd1(c("Eptesicus_nasutus", "Eptesicus_bobrinskoi", "Eptesicus_gobiensis", "Eptesicus_japonensis", "Eptesicus_nilssonii", "Eptesicus_diminutus", "Eptesicus_innoxius", "Eptesicus_chiriquinus", "Eptesicus_brasiliensis", "Eptesicus_andinus", "Eptesicus_bottae", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus", "Eptesicus_dimissus", "Eptesicus_guadeloupensis", "Eptesicus_pachyotis", "Eptesicus_platyops",  "Eptesicus_tatei"), "Eptesicus_floweri")
SisterAnd1(c("Eptesicus_nasutus", "Eptesicus_bobrinskoi", "Eptesicus_gobiensis", "Eptesicus_japonensis", "Eptesicus_nilssonii", "Eptesicus_diminutus", "Eptesicus_innoxius", "Eptesicus_chiriquinus", "Eptesicus_brasiliensis", "Eptesicus_andinus", "Eptesicus_bottae", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus", "Eptesicus_dimissus", "Eptesicus_guadeloupensis", "Eptesicus_pachyotis", "Eptesicus_platyops",  "Eptesicus_tatei", "Eptesicus_floweri"), "Eptesicus_matroka" )
#Place Eptesicus_malagasyensis based on taxonomy
SisterOrSing1(c("Eptesicus_nasutus", "Eptesicus_bobrinskoi", "Eptesicus_gobiensis", "Eptesicus_japonensis", "Eptesicus_nilssonii", "Eptesicus_diminutus", "Eptesicus_innoxius", "Eptesicus_chiriquinus", "Eptesicus_brasiliensis", "Eptesicus_andinus", "Eptesicus_bottae", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus", "Eptesicus_dimissus", "Eptesicus_guadeloupensis", "Eptesicus_pachyotis", "Eptesicus_platyops",  "Eptesicus_tatei", "Eptesicus_floweri", "Eptesicus_matroka"),  "Eptesicus_malagasyensis")
#Place Laephotis_angolensis based on taxonomy
SisterOrSing1(c("Laephotis_botswanae", "Laephotis_namibensis", "Laephotis_wintoni"), "Laephotis_angolensis")
#Place most missing species of Miniopterus based on Nature 446, 507-512 (2007)
TR<-read.tree(text="((Miniopterus_fuscus:1,Miniopterus_medius:1):1, Miniopterus_fraterculus:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO),"Miniopterus_fraterculus"))
Sister1("Miniopterus_macrocneme", "Miniopterus_pusillus")
Sister1("Miniopterus_tristis", "Miniopterus_robustior")
#Place species of Miniopterus not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Miniopterus_fraterculus", "Miniopterus_fuliginosus", "Miniopterus_gleni", "Miniopterus_griveaudi", "Miniopterus_inflatus", "Miniopterus_macrocneme", "Miniopterus_magnater", "Miniopterus_majori", "Miniopterus_manavi", "Miniopterus_minor", "Miniopterus_natalensis", "Miniopterus_newtoni", "Miniopterus_oceanensis", "Miniopterus_paululus", "Miniopterus_petersoni", "Miniopterus_schreibersii", "Miniopterus_sororculus", "Miniopterus_tristis","Miniopterus_fuscus", "Miniopterus_medius", "Miniopterus_pusillus", "Miniopterus_robustior")
MIS<-c("Miniopterus_shortridgei", "Miniopterus_australis")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place most missing species of Murina based on Nature 446, 507-512 (2007)
SisterAnd1(c("Murina_leucogaster", "Murina_hilgendorfi"), "Murina_fusca")
Start<-c(list(c("Murina_leucogaster", "Murina_hilgendorfi", "Murina_fusca")), "Murina_florium", "Murina_suilla",  "Murina_tubinaris", "Murina_aurata")
MIS<-c("Murina_tenebrosa", "Murina_ussuriensis")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place species of Murina not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Murina_aenea", "Murina_cyclotis", "Murina_florium", "Murina_hilgendorfi", "Murina_huttoni", "Murina_leucogaster", "Murina_puta", "Murina_rozendaali", "Murina_suilla", "Murina_tubinaris", "Murina_fusca", "Murina_aurata", "Murina_tenebrosa", "Murina_ussuriensis") 
MIS<-c("Murina_harrisoni", "Murina_ryukyuana")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place most missing species of Myotis based on Nature 446, 507-512 (2007)
Sister1("Myotis_lucifugus", "Myotis_occultus")
SisterOrSing1(c("Myotis_macrotarsus", "Myotis_vivesi"), "Myotis_stalkeri")
Sister1("Myotis_formosus", "Myotis_hermani")
SisterOrSing1(c("Myotis_emarginatus", list(c("Myotis_goudoti", "Myotis_anjouanensis")),"Myotis_tricolor"), "Myotis_morrisi")
Sister1("Myotis_altarium", "Myotis_oreias")
SisterOrSing1(c("Myotis_leibii", "Myotis_ciliolabrum"), "Myotis_melanorhinus")
Sister1("Myotis_frater", "Myotis_bucharensis")
SisterOrSing1(c(list(c("Myotis_mystacinus", "Myotis_hajastanicus", "Myotis_nipalensis", "Myotis_davidii")), "Myotis_brandtii"), "Myotis_insularum")
Sister1("Myotis_muricola", "Myotis_ater")
SisterOrSing1(c("Myotis_annectans",  "Myotis_ikonnikovi", "Myotis_ridleyi", "Myotis_rosseti", list(c("Myotis_muricola", "Myotis_ater"))), "Myotis_australis")
Start<-c("Myotis_atacamensis", "Myotis_dominicensis", "Myotis_elegans", "Myotis_keaysi", "Myotis_martiniquensis", "Myotis_nigricans", "Myotis_sodalis") 
MIS<-c("Myotis_findleyi", "Myotis_nesopolus")
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
SisterOrSing1(c(list(c("Myotis_leibii", "Myotis_melanorhinus", "Myotis_ciliolabrum")), "Myotis_californicus"), "Myotis_planiceps")
Start<-c( "Myotis_austroriparius", "Myotis_chiloensis", "Myotis_dasycneme", "Myotis_fortidens", "Myotis_grisescens", "Myotis_levis", "Myotis_montivagus", "Myotis_oxyotus", "Myotis_velifer", "Myotis_volans", "Myotis_yumanensis", "Myotis_albescens",
list(c("Myotis_formosus", "Myotis_hermani", "Myotis_welwitschii", "Myotis_pequinius", "Myotis_bombinus", "Myotis_nattereri", "Myotis_schaubi", "Myotis_thysanodes", "Myotis_emarginatus", "Myotis_goudoti", "Myotis_anjouanensis",  "Myotis_morrisi", "Myotis_tricolor", "Myotis_blythii", "Myotis_punicus", "Myotis_chinensis", "Myotis_myotis", "Myotis_sicarius", "Myotis_bechsteinii", "Myotis_auriculus", "Myotis_evotis", "Myotis_keenii", "Myotis_septentrionalis"))
,list(c("Myotis_riparius", "Myotis_simus", "Myotis_ruber")), list(c("Myotis_macrotarsus", "Myotis_stalkeri", "Myotis_vivesi")), list(c("Myotis_lucifugus", "Myotis_occultus")), 
 list(c("Myotis_atacamensis", "Myotis_dominicensis", "Myotis_elegans", "Myotis_keaysi", "Myotis_martiniquensis",  "Myotis_nigricans", "Myotis_sodalis", "Myotis_findleyi", "Myotis_nesopolus", "Myotis_siligorensis", "Myotis_scotti",  "Myotis_oreias", "Myotis_altarium", "Myotis_californicus", "Myotis_leibii", "Myotis_melanorhinus", "Myotis_ciliolabrum",  "Myotis_planiceps", "Myotis_brandtii", "Myotis_insularum", "Myotis_mystacinus", "Myotis_hajastanicus", "Myotis_nipalensis", "Myotis_davidii", "Myotis_annectans", "Myotis_ikonnikovi", "Myotis_ridleyi", "Myotis_rosseti", "Myotis_frater", "Myotis_bucharensis", "Myotis_muricola", "Myotis_ater")))
MIS<-c("Myotis_aelleni", "Myotis_cobanensis", "Myotis_peninsularis", "Myotis_pilosus")
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
Sister1("Myotis_mystacinus", "Myotis_aurascens")
#Place species of Myotis not covered in Nature 446, 507-512 (2007) based on taxonomy
Start<-c("Myotis_austroriparius", "Myotis_chiloensis", "Myotis_dasycneme", "Myotis_fortidens", "Myotis_grisescens", "Myotis_levis", "Myotis_montivagus", "Myotis_oxyotus", "Myotis_velifer", "Myotis_volans", "Myotis_yumanensis",
"Myotis_formosus", "Myotis_hermani", "Myotis_welwitschii", "Myotis_pequinius", "Myotis_bombinus", "Myotis_nattereri",  "Myotis_schaubi", "Myotis_thysanodes", "Myotis_emarginatus", "Myotis_goudoti", "Myotis_anjouanensis", "Myotis_morrisi", "Myotis_tricolor", "Myotis_blythii",
 "Myotis_punicus", "Myotis_chinensis", "Myotis_myotis", "Myotis_sicarius", "Myotis_bechsteinii", "Myotis_auriculus", "Myotis_evotis", "Myotis_keenii",  "Myotis_septentrionalis" ,"Myotis_riparius", "Myotis_simus", "Myotis_ruber", "Myotis_macrotarsus", "Myotis_stalkeri", "Myotis_vivesi", 
"Myotis_lucifugus", "Myotis_occultus", "Myotis_albescens","Myotis_atacamensis", "Myotis_dominicensis", "Myotis_elegans", "Myotis_keaysi", "Myotis_martiniquensis",  "Myotis_nigricans", "Myotis_sodalis", "Myotis_findleyi", "Myotis_nesopolus", "Myotis_siligorensis",
 "Myotis_scotti", "Myotis_oreias", "Myotis_altarium", "Myotis_californicus", "Myotis_leibii", "Myotis_melanorhinus", "Myotis_ciliolabrum", "Myotis_planiceps", "Myotis_brandtii", "Myotis_insularum", "Myotis_mystacinus", "Myotis_hajastanicus", "Myotis_nipalensis","Myotis_davidii", "Myotis_annectans", 
"Myotis_ikonnikovi", "Myotis_ridleyi", "Myotis_rosseti", "Myotis_frater", "Myotis_bucharensis", "Myotis_muricola", "Myotis_ater", "Myotis_aelleni", "Myotis_cobanensis", "Myotis_peninsularis", "Myotis_aurascens")
MIS<-c("Myotis_csorbai", "Myotis_dieteri", "Myotis_dinellii", "Myotis_rufopictus")
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
#Place Vespertilio_sinensis based on taxonomy
Sister1("Vespertilio_murinus", "Vespertilio_sinensis")
#Place Plecotus_taivanus based on taxonomy
SisterOrSing1(c("Plecotus_austriacus", "Plecotus_balensis", "Plecotus_christii", "Plecotus_kolombatovici", "Plecotus_macrobullaris", "Plecotus_ognevi", "Plecotus_sacrimontis", "Plecotus_sardus", "Plecotus_teneriffae"), "Plecotus_taivanus")
#Place Rhogeessa_minutilla based on Nature 446, 507-512 (2007)
SisterOrSing1(list(c(c("Rhogeessa_tumida", "Rhogeessa_aeneus", "Rhogeessa_io")), "Rhogeessa_genowaysi", "Rhogeessa_parvula"),  "Rhogeessa_minutilla")
#Place Rhogeessa_hussoni based on taxonomy
SisterOrSing1(c("Rhogeessa_aeneus", "Rhogeessa_alleni", "Rhogeessa_genowaysi", "Rhogeessa_gracilis",  "Rhogeessa_io", "Rhogeessa_mira", "Rhogeessa_parvula", "Rhogeessa_tumida"), "Rhogeessa_hussoni")
#Place Scotophilus_celebensis based on uncertain species status
Sister1("Scotophilus_heathii", "Scotophilus_celebensis")
#Place Scotophilus_collinus and Scotophilus_nucella based on Nature 446, 507-512 (2007)
Sister1("Scotophilus_kuhlii", "Scotophilus_collinus")
Sister1("Scotophilus_leucogaster", "Scotophilus_nucella")
#Place Scotophilus_tandrefana based on taxonomy
SisterOrSing1(c("Scotophilus_borbonicus", "Scotophilus_celebensis", "Scotophilus_collinus", "Scotophilus_dinganii", "Scotophilus_heathii", "Scotophilus_kuhlii", "Scotophilus_leucogaster", "Scotophilus_marovaza", "Scotophilus_nigrita", "Scotophilus_nucella", "Scotophilus_nux", "Scotophilus_robustus", "Scotophilus_viridis"), "Scotophilus_tandrefana")
#Place Pharotis and Nyctophilus combined as sister to Nyctalus based on Nature 446, 507-512 (2007)
SisterAnd1(c("Nyctalus_aviator", "Nyctalus_azoreum", "Nyctalus_lasiopterus", "Nyctalus_leisleri", "Nyctalus_noctula", "Nyctalus_plancyi", "Nyctalus_furvus", "Nyctalus_montanus"), "Pharotis_imogene")
TR<-read.tree(text="(Pharotis_imogene:1, (Nyctophilus_howensis:1, Nyctophilus_arnhemensis:1,Nyctophilus_geoffroyi:1,(Nyctophilus_gouldi:1, Nyctophilus_bifax:1):1,Nyctophilus_heran:1,Nyctophilus_microdon:1,Nyctophilus_microtis:1,(Nyctophilus_timoriensis:1, Nyctophilus_sherrini:1):1,Nyctophilus_walkeri:1, Nyctophilus_nebulosus:1):1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Pharotis_imogene"))
#Place Mimetillus, Scotozous, Scoteanax and Falsistrellus in large polytomi in the family based on Nature 446, 507-512 (2007)
Start<-c("Eudiscopus_denticulus", "Ia_io",  "Otonycteris_hemprichii", "Philetor_brachypterus", list(c("Vespertilio_murinus", "Vespertilio_sinensis")), list(c("Vespadelus_regulus", "Vespadelus_vulturnus", "Vespadelus_baverstocki", "Vespadelus_caurinus", "Vespadelus_darlingtoni", "Vespadelus_douglasorum", "Vespadelus_finlaysoni", "Vespadelus_pumilus", "Vespadelus_troughtoni")), list(c("Scotoecus_pallidus", "Scotoecus_hirundo", "Scotoecus_albofuscus")), list(c("Scotomanes_ornatus", "Scotophilus_dinganii", "Scotophilus_heathii", "Scotophilus_kuhlii", "Scotophilus_leucogaster", "Scotophilus_marovaza", "Scotophilus_nigrita", "Scotophilus_nux", "Scotophilus_robustus", "Scotophilus_viridis", "Scotophilus_collinus", "Scotophilus_nucella")), list(c("Nycticeius_humeralis", "Nycticeius_cubanus")), 
list(c("Glauconycteris_argentata", "Glauconycteris_beatrix", "Glauconycteris_egeria", "Glauconycteris_variegata", "Glauconycteris_alboguttata", "Glauconycteris_curryae", "Glauconycteris_gleni", "Glauconycteris_kenyacola", "Glauconycteris_poensis", "Glauconycteris_superba", "Glauconycteris_humeralis", "Glauconycteris_machadoi")), list(c("Laephotis_botswanae", "Laephotis_namibensis", "Laephotis_wintoni", "Laephotis_angolensis")), list(c("Hesperoptenus_blanfordi", "Hesperoptenus_tickelli", "Hesperoptenus_doriae", "Hesperoptenus_gaskelli", "Hesperoptenus_tomesi", "Hesperoptenus_doriae", "Hesperoptenus_tickelli")), list(c("Glischropus_tylopus", "Glischropus_javanus")), list(c("Histiotus_magellanicus", "Histiotus_macrotus", "Histiotus_alienus", "Histiotus_humboldti", "Histiotus_velatus","Histiotus_laephotis", "Histiotus_montanus")),
list(c("Arielulus_aureocollaris", "Arielulus_circumdatus", "Arielulus_cuprosus", "Arielulus_societatis", "Arielulus_torquatus")), list(c("Barbastella_barbastellus", "Barbastella_leucomelas", "Euderma_maculatum", "Idionycteris_phyllotis", "Corynorhinus_rafinesquii", "Corynorhinus_mexicanus", "Corynorhinus_townsendii", "Plecotus_austriacus", "Plecotus_balensis", "Plecotus_christii", "Plecotus_kolombatovici", "Plecotus_macrobullaris", "Plecotus_ognevi", "Plecotus_sacrimontis", "Plecotus_sardus", "Plecotus_teneriffae", "Plecotus_taivanus")), list(c("Chalinolobus_gouldii", "Chalinolobus_morio", "Chalinolobus_dwyeri", "Chalinolobus_nigrogriseus", "Chalinolobus_picatus", "Chalinolobus_neocaledonicus", "Chalinolobus_tuberculatus")),
list(c("Eptesicus_nasutus", "Eptesicus_bobrinskoi", "Eptesicus_gobiensis", "Eptesicus_japonensis", "Eptesicus_nilssonii", "Eptesicus_diminutus", "Eptesicus_innoxius", "Eptesicus_chiriquinus", "Eptesicus_brasiliensis", "Eptesicus_andinus", "Eptesicus_bottae", "Eptesicus_furinalis", "Eptesicus_fuscus", "Eptesicus_hottentotus", "Eptesicus_serotinus", "Eptesicus_dimissus", "Eptesicus_guadeloupensis", "Eptesicus_pachyotis", "Eptesicus_platyops",  "Eptesicus_tatei", "Eptesicus_floweri", "Eptesicus_matroka",  "Eptesicus_malagasyensis")), list(c("Lasiurus_atratus","Lasiurus_borealis", "Lasiurus_blossevillii", "Lasiurus_minor", "Lasiurus_pfeifferi", "Lasiurus_varius", "Lasiurus_degelidus", "Lasiurus_seminolus", "Lasiurus_cinereus", "Lasiurus_castaneus", "Lasiurus_ega", "Lasiurus_xanthinus", "Lasiurus_intermedius", "Lasiurus_insularis",  "Lasiurus_egregius", "Lasiurus_ebenus")),
list(c("Nyctalus_aviator", "Nyctalus_azoreum", "Nyctalus_lasiopterus", "Nyctalus_leisleri", "Nyctalus_noctula", "Nyctalus_plancyi", "Nyctalus_furvus", "Nyctalus_montanus", "Pharotis_imogene", "Nyctophilus_arnhemensis", "Nyctophilus_bifax", "Nyctophilus_geoffroyi", "Nyctophilus_gouldi","Nyctophilus_heran", "Nyctophilus_howensis", "Nyctophilus_microdon", "Nyctophilus_microtis","Nyctophilus_nebulosus", "Nyctophilus_sherrini", "Nyctophilus_timoriensis", "Nyctophilus_walkeri")),list(c("Nycticeinops_schlieffeni", "Scotorepens_balstoni", "Scotorepens_orion", "Scotorepens_greyii", "Scotorepens_sanborni")),  
list(c("Pipistrellus_subflavus",  "Pipistrellus_eisentrauti", "Pipistrellus_anchietae",  "Pipistrellus_hesperus", "Pipistrellus_musciculus", "Pipistrellus_imbricatus", "Pipistrellus_arabicus", "Pipistrellus_helios", "Pipistrellus_nanus", "Pipistrellus_cadornae", "Pipistrellus_macrotis", "Pipistrellus_vordermanni", "Pipistrellus_ariel", "Pipistrellus_alaschanicus", "Pipistrellus_savii", "Pipistrellus_kuhlii", "Pipistrellus_hesperidus", "Pipistrellus_rendalli", "Pipistrellus_flavescens", "Pipistrellus_tenuipinnis", "Pipistrellus_brunneus", "Pipistrellus_somalicus", "Pipistrellus_capensis", "Pipistrellus_guineensis", "Pipistrellus_melckorum", "Pipistrellus_zuluensis", "Pipistrellus_deserti", "Pipistrellus_aero", "Pipistrellus_inexspectatus", "Pipistrellus_maderensis", "Pipistrellus_rusticus", "Pipistrellus_kuhlii", "Pipistrellus_hesperidus", "Pipistrellus_nathusii", "Pipistrellus_pipistrellus", "Pipistrellus_pygmaeus", "Pipistrellus_permixtus", "Pipistrellus_javanicus", 
"Pipistrellus_paterculus",  "Pipistrellus_endoi",  "Pipistrellus_abramus", "Pipistrellus_coromandra", "Pipistrellus_tenuis", "Pipistrellus_adamsi", "Pipistrellus_angulatus", "Pipistrellus_collinus", "Pipistrellus_papuanus", "Pipistrellus_wattsi", "Pipistrellus_westralis", "Pipistrellus_minahassae",  "Pipistrellus_ceylonicus", "Pipistrellus_anthonyi", "Pipistrellus_joffrei", "Pipistrellus_stenopterus", "Pipistrellus_crassulus", "Pipistrellus_nanulus", "Pipistrellus_rueppellii", "Pipistrellus_pulveratus", "Pipistrellus_kitcheneri", "Pipistrellus_lophurus", "Pipistrellus_hanaki", "Pipistrellus_murrayi", "Pipistrellus_raceyi")),
list(c("Rhogeessa_aeneus", "Rhogeessa_alleni", "Rhogeessa_genowaysi", "Rhogeessa_gracilis", "Rhogeessa_hussoni", "Rhogeessa_io", "Rhogeessa_mira", "Rhogeessa_parvula", "Rhogeessa_tumida", "Rhogeessa_hussoni")))
MIS<-c("Mimetillus_moloneyi", "Scotozous_dormeri",  "Scoteanax_rueppellii", "Falsistrellus_mackenziei")
MIS1<-MIS[sample.int(4, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(3, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
MIS1<-MIS[sample.int(2, 1)]; SisterOrSing1(Start, MIS1); MIS<-MIS[MIS%in%MIS1==F]; Start<-c(Start, MIS1)
SisterOrSing1(Start, MIS)
TR<-read.tree(text="((Falsistrellus_mackenziei:1, Falsistrellus_tasmaniensis:1):1, Falsistrellus_affinis:1):1;")
PHYLO<<-bind.tree(PHYLO, TR ,  getNode(phylo4(PHYLO), "Falsistrellus_mackenziei"))
Sister2("Falsistrellus_affinis", "Falsistrellus_mordax", "Falsistrellus_petersi")

#Simulate potential branch lengths wihtin the family based on MRCA of family equal to 46 MYA following Meredith et al (2011)
BD.gen(46,0.355)
PHYLO->Vespertilionidae

################################################################################################################################################################
###########################################################The interfamily relationship#########################################################################
################################################################################################################################################################
#The relationsnip between the families in the order. The relationship is not fully resolved and there are several possible trees. 
#This example is just based on a single value but 1000 trees can be generated by varying "A" between 1 and 1000

A6<-sample.int(1000,1000)
if (A6[1]<551) {Chiroptera<-read.tree(text="((((((((Amorphochilus_schnablii:11.5,Furipterus_horrens:11.5):22.72,(Noctilio_leporinus:2, Noctilio_albiventris:2):32.22):7.12, (Mormoopidae:0, Phyllostomidae:0.76):5.58):0.68, Thyropteridae:32.02):5.77, Mystacinidae:0):7.91, (Emballonuridae:9.36, Nycteridae:39.26):4.34):0.58, (((Vespertilionidae:3.55, Molossidae:0):2.28, Natalidae:35.83):2.8, (Myzopoda_aurita:0.07, Myzopoda_schliemanni:0.07):54.56):1.65):10.24, (Pteropodidae:45.53, ((Hipposideridae:12.24, Rhinolophidae:21.24):13.45, ((Craseonycteris_thonglongyai:46.25, Megadermatidae:20.05):6.43, Rhinopomatidae:23.68):3.01):7.23):3.6);",)} else 
if (A6[1]<960) {Chiroptera<-read.tree(text="((((((Vespertilionidae:3.55, Molossidae:0):2.28, Natalidae:35.83):2.8, (Myzopoda_aurita:0.07, Myzopoda_schliemanni:0.07):54.56):1.07, (Emballonuridae:9.36, Nycteridae:39.26):4.34):0.58, (((((Amorphochilus_schnablii:11.5,Furipterus_horrens:11.5):22.72,(Noctilio_leporinus:2, Noctilio_albiventris:2):32.22):7.12, (Mormoopidae:0, Phyllostomidae:0.76):5.58):0.68, Thyropteridae:32.02):5.77, Mystacinidae:0):8.49):10.24, (Pteropodidae:45.53, ((Hipposideridae:12.24, Rhinolophidae:21.24):13.45, ((Craseonycteris_thonglongyai:46.25, Megadermatidae:20.05):6.43, Rhinopomatidae:23.68):3.01):7.23):3.6);")} else 
{Chiroptera<-read.tree(text="((((((Vespertilionidae:3.55, Molossidae:0):2.28, Natalidae:35.83):2.8, (Myzopoda_aurita:0.07, Myzopoda_schliemanni:0.07):54.56):1.07, (((((Amorphochilus_schnablii:11.5,Furipterus_horrens:11.5):22.72,(Noctilio_leporinus:2, Noctilio_albiventris:2):32.22):7.12, (Mormoopidae:0, Phyllostomidae:0.76):5.58):0.68, Thyropteridae:32.02):5.77, Mystacinidae:0):7.91):0.58, (Emballonuridae:9.36, Nycteridae:39.26):4.92):10.24, (Pteropodidae:45.53, ((Hipposideridae:12.24, Rhinolophidae:21.24):13.45, ((Craseonycteris_thonglongyai:46.25, Megadermatidae:20.05):6.43, Rhinopomatidae:23.68):3.01):7.23):3.6);")}
Chiroptera<-bind.tree(Chiroptera, Emballonuridae, getNode(phylo4(Chiroptera),"Emballonuridae"))
Chiroptera<-bind.tree(Chiroptera, Hipposideridae, getNode(phylo4(Chiroptera),"Hipposideridae"))
Chiroptera<-bind.tree(Chiroptera, Megadermatidae, getNode(phylo4(Chiroptera),"Megadermatidae"))
Chiroptera<-bind.tree(Chiroptera, Molossidae, getNode(phylo4(Chiroptera),"Molossidae")); Chiroptera<-drop.tip(Chiroptera, "Rootnode_Molossidae")
Chiroptera<-bind.tree(Chiroptera, Mormoopidae, getNode(phylo4(Chiroptera),"Mormoopidae")); Chiroptera<-drop.tip(Chiroptera, "Rootnode_Mormoopidae")
Chiroptera<-bind.tree(Chiroptera, Mystacinidae, getNode(phylo4(Chiroptera),"Mystacinidae")); Chiroptera<-drop.tip(Chiroptera, "Rootnode_Mystacinidae")
Chiroptera<-bind.tree(Chiroptera, Natalidae, getNode(phylo4(Chiroptera),"Natalidae"))
Chiroptera<-bind.tree(Chiroptera, Nycteridae, getNode(phylo4(Chiroptera),"Nycteridae"))
Chiroptera<-bind.tree(Chiroptera, Phyllostomidae, getNode(phylo4(Chiroptera),"Phyllostomidae"))
Chiroptera<-bind.tree(Chiroptera, Pteropodidae, getNode(phylo4(Chiroptera),"Pteropodidae"))
Chiroptera<-bind.tree(Chiroptera, Rhinolophidae, getNode(phylo4(Chiroptera),"Rhinolophidae"))
Chiroptera<-bind.tree(Chiroptera, Rhinopomatidae, getNode(phylo4(Chiroptera),"Rhinopomatidae"))
Chiroptera<-bind.tree(Chiroptera, Thyropteridae, getNode(phylo4(Chiroptera),"Thyropteridae"))
Chiroptera<-bind.tree(Chiroptera, Vespertilionidae, getNode(phylo4(Chiroptera),"Vespertilionidae"))

is.ultrametric(Chiroptera)

write.tree(Chiroptera, "Chiroptera.nex")

sort(Chiroptera$Tip.label)

